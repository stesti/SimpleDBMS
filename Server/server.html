<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>server.cpp</title>
	<style type="text/css">
/* Stylesheet generated from TextMate theme
 *
 * Mac Classic
 * 
 *
 */

/* Mostly to improve view within the TextMate HTML viewer */
body {
	margin: 0;
	padding: 0;
}

pre.textmate-source {
	margin: 0;
	padding: 0 0 0 2px;
	font-family: Monaco, monospace;
	font-size: 11px;
	line-height: 1.3em;
	word-wrap: break-word;
	white-space: pre;
	white-space: pre-wrap;
	white-space: -moz-pre-wrap;
	white-space: -o-pre-wrap;
}

pre.textmate-source.mac_classic {
	color: #000000;
	background-color: #FFFFFF;
}

pre.textmate-source .linenum {
	width: 75px;
	padding: 0.1em 1em 0.2em 0;
	color: #888;
	background-color: #eee;
}
pre.textmate-source.mac_classic span {
   padding-top: 0.2em;
   padding-bottom: 0.1em;
}
pre.textmate-source.mac_classic ::selection {
	background-color: rgba(77, 151, 255, 0.33);
}
/* Comment */
pre.textmate-source.mac_classic .comment {
	color: #0066FF;
	font-style: italic;
}

/* Keyword */
pre.textmate-source.mac_classic .keyword, pre.textmate-source.mac_classic .storage {
	color: #0000FF;
	font-weight: bold;
}

/* Number */
pre.textmate-source.mac_classic .constant_numeric {
	color: #0000CD;
}

/* User-defined constant */
pre.textmate-source.mac_classic .constant {
	color: #C5060B;
	font-weight: bold;
}

/* Built-in constant */
pre.textmate-source.mac_classic .constant_language {
	color: #585CF6;
	font-weight: bold;
}

/* Variable */
pre.textmate-source.mac_classic .variable_language, pre.textmate-source.mac_classic .variable_other {
	color: #318495;
}

/* String */
pre.textmate-source.mac_classic .string {
	color: #036A07;
}

/* String interpolation */
pre.textmate-source.mac_classic .constant_character_escape, pre.textmate-source.mac_classic .string .source {
	color: #26B31A;
}

/* Preprocessor line */
pre.textmate-source.mac_classic .meta_preprocessor {
	color: #1A921C;
}

/* Preprocessor directive */
pre.textmate-source.mac_classic .keyword_control_import {
	color: #0C450D;
	font-weight: bold;
}

/* Function name */
pre.textmate-source.mac_classic .entity_name_function, pre.textmate-source.mac_classic .support_function_any-method {
	color: #0000A2;
	font-weight: bold;
}

/* Type name */
pre.textmate-source.mac_classic .entity_name_type {
	text-decoration: underline;
}

/* Inherited class name */
pre.textmate-source.mac_classic .entity_other_inherited-class {
	font-style: italic;
}

/* Function parameter */
pre.textmate-source.mac_classic .variable_parameter {
	font-style: italic;
}

/* Function argument and result types */
pre.textmate-source.mac_classic .storage_type_method {
	color: #70727E;
}

/* Section */
pre.textmate-source.mac_classic .meta_section .entity_name_section, pre.textmate-source.mac_classic .declaration_section .entity_name_section {
	font-style: italic;
}

/* Library function */
pre.textmate-source.mac_classic .support_function {
	color: #3C4C72;
	font-weight: bold;
}

/* Library object */
pre.textmate-source.mac_classic .support_class, pre.textmate-source.mac_classic .support_type {
	color: #6D79DE;
	font-weight: bold;
}

/* Library constant */
pre.textmate-source.mac_classic .support_constant {
	color: #06960E;
	font-weight: bold;
}

/* Library variable */
pre.textmate-source.mac_classic .support_variable {
	color: #21439C;
	font-weight: bold;
}

/* JS: Operator */
pre.textmate-source.mac_classic .keyword_operator_js {
	color: #687687;
}

/* Invalid */
pre.textmate-source.mac_classic .invalid {
	color: #FFFFFF;
	background-color: #990000;
}

/* Invalid trailing whitespace */
pre.textmate-source.mac_classic .invalid_deprecated_trailing-whitespace {
	background-color: #FFD0D0;
}

/* Embedded source */
pre.textmate-source.mac_classic .text .source, pre.textmate-source.mac_classic .string_unquoted {
	background-color: rgba(0, 0, 0, 0.05);
}

/* Embedded embedded source */
pre.textmate-source.mac_classic .text .source .string_unquoted, pre.textmate-source.mac_classic .text .source .text .source {
	background-color: rgba(0, 0, 0, 0.06);
}

/* Markup XML declaration */
pre.textmate-source.mac_classic .meta_tag_preprocessor_xml {
	color: #68685B;
}

/* Markup DOCTYPE */
pre.textmate-source.mac_classic .meta_tag_sgml_doctype, pre.textmate-source.mac_classic .meta_tag_sgml_doctype .entity, pre.textmate-source.mac_classic .meta_tag_sgml_doctype .string, pre.textmate-source.mac_classic .meta_tag_preprocessor_xml, pre.textmate-source.mac_classic .meta_tag_preprocessor_xml .entity, pre.textmate-source.mac_classic .meta_tag_preprocessor_xml .string {
	color: #888888;
}

/* Markup DTD */
pre.textmate-source.mac_classic .string_quoted_docinfo_doctype_DTD {
	font-style: italic;
}

/* Markup tag */
pre.textmate-source.mac_classic .meta_tag, pre.textmate-source.mac_classic .declaration_tag {
	color: #1C02FF;
}

/* Markup name of tag */
pre.textmate-source.mac_classic .entity_name_tag {
	font-weight: bold;
}

/* Markup tag attribute */
pre.textmate-source.mac_classic .entity_other_attribute-name {
	font-style: italic;
}

/* Markup: Heading */
pre.textmate-source.mac_classic .markup_heading {
	color: #0C07FF;
	font-weight: bold;
}

/* Markup: Quote */
pre.textmate-source.mac_classic .markup_quote {
	color: #000000;
	font-style: italic;
}

/* Markup: List */
pre.textmate-source.mac_classic .markup_list {
	color: #B90690;
}



	</style>
</head>

<body><pre class="textmate-source mac_classic"><span class='linenum'>    1</span> <span class="source source_c++"><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  ==========================================
</span><span class='linenum'>    2</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  ||  Simple DBMS System - Server         ||
</span><span class='linenum'>    3</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  ==========================================
</span><span class='linenum'>    4</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>    5</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  Coded in 2009 by
</span><span class='linenum'>    6</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  Davide.Perina@studenti.unitn.it
</span><span class='linenum'>    7</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  Stefano.Testi@studenti.unitn.it
</span><span class='linenum'>    8</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>    9</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  This work is released under the Creative Commons License
</span><span class='linenum'>   10</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  Attribution-Noncommercial-Share Alike 3.0
</span><span class='linenum'>   11</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>   12</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>   13</span> 
<span class='linenum'>   14</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>sys/socket.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   15</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>netinet/in.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   16</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>sys/types.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   17</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>stdio.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   18</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>netdb.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   19</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>string.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   20</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>unistd.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   21</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>stdlib.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   22</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>iostream<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   23</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>fstream<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   24</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>arpa/inet.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   25</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>list<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   26</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>time.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   27</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>sys/wait.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   28</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>signal.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   29</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>sys/time.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   30</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>sys/ioctl.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   31</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>net/if.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   32</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>arpa/inet.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   33</span> 
<span class='linenum'>   34</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Timeout in seconds for a pending operation to be declared 'in timeout'
</span><span class='linenum'>   35</span> <span class="meta meta_preprocessor meta_preprocessor_macro meta_preprocessor_macro_c">#<span class="keyword keyword_control keyword_control_import keyword_control_import_define keyword_control_import_define_c">define</span> <span class="entity entity_name entity_name_function entity_name_function_preprocessor entity_name_function_preprocessor_c">lifetime_row</span> <span class="constant constant_numeric constant_numeric_c">5</span></span>
<span class='linenum'>   36</span> 
<span class='linenum'>   37</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> How often to check the list of pending operations to clean it?
</span><span class='linenum'>   38</span> <span class="meta meta_preprocessor meta_preprocessor_macro meta_preprocessor_macro_c">#<span class="keyword keyword_control keyword_control_import keyword_control_import_define keyword_control_import_define_c">define</span> <span class="entity entity_name entity_name_function entity_name_function_preprocessor entity_name_function_preprocessor_c">timeout</span> <span class="constant constant_numeric constant_numeric_c">10</span></span>
<span class='linenum'>   39</span> 
<span class='linenum'>   40</span> <span class="keyword keyword_control keyword_control_c++">using</span> <span class="meta meta_namespace-block meta_namespace-block_c++"><span class="storage storage_type storage_type_c++">namespace</span> <span class="entity entity_name entity_name_type entity_name_type_c++">std</span></span>;
<span class='linenum'>   41</span> 
<span class='linenum'>   42</span> 
<span class='linenum'>   43</span> 
<span class='linenum'>   44</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> DATA TYPES
</span><span class='linenum'>   45</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>   46</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Declaring data types:
</span><span class='linenum'>   47</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>     - replica
</span><span class='linenum'>   48</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           This data type is used to represent the coordinates to access
</span><span class='linenum'>   49</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           one of the replicated DB servers. It contains an integer identifier
</span><span class='linenum'>   50</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           for the replica, the IP address and the port.
</span><span class='linenum'>   51</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>     - couple
</span><span class='linenum'>   52</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           This data type is used to represent the specific operation to perform on
</span><span class='linenum'>   53</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           one of the servers.
</span><span class='linenum'>   54</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>     - db_msg
</span><span class='linenum'>   55</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           This is the message exchanged between the client and the servers,
</span><span class='linenum'>   56</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           and between the servers.
</span><span class='linenum'>   57</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>     - pending
</span><span class='linenum'>   58</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           This is the data type used to represent a currently-ongoing operation.
</span><span class='linenum'>   59</span> 
<span class='linenum'>   60</span> 
<span class='linenum'>   61</span> <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">replica</span> <span class="punctuation punctuation_definition punctuation_definition_scope punctuation_definition_scope_c++">{</span>
<span class='linenum'>   62</span>     <span class="storage storage_type storage_type_c">int</span> id;                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Server ID
</span><span class='linenum'>   63</span>     <span class="storage storage_type storage_type_c">char</span> ip[<span class="constant constant_numeric constant_numeric_c">15</span>];                <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Server IP
</span><span class='linenum'>   64</span>     <span class="storage storage_type storage_type_c">int</span> port;                   <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Server Port
</span><span class='linenum'>   65</span> <span class="punctuation punctuation_definition punctuation_definition_invalid punctuation_definition_invalid_c++">}</span></span>;
<span class='linenum'>   66</span> 
<span class='linenum'>   67</span> 
<span class='linenum'>   68</span> <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">couple</span> <span class="punctuation punctuation_definition punctuation_definition_scope punctuation_definition_scope_c++">{</span>
<span class='linenum'>   69</span>     <span class="storage storage_type storage_type_c">char</span> operation;             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Operation: Q, D or I
</span><span class='linenum'>   70</span>     <span class="storage storage_type storage_type_c">int</span> key;                    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Key
</span><span class='linenum'>   71</span>     <span class="storage storage_type storage_type_c">int</span> value;                  <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Value
</span><span class='linenum'>   72</span> <span class="punctuation punctuation_definition punctuation_definition_invalid punctuation_definition_invalid_c++">}</span></span>;
<span class='linenum'>   73</span> 
<span class='linenum'>   74</span> <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> <span class="punctuation punctuation_definition punctuation_definition_scope punctuation_definition_scope_c++">{</span>
<span class='linenum'>   75</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">couple</span> cpl</span>;          <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Operation to perform and parameters
</span><span class='linenum'>   76</span>     <span class="storage storage_type storage_type_c">char</span> cs;                    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Message involving a client (C) or inter-server (S)
</span><span class='linenum'>   77</span>     <span class="storage storage_type storage_type_c">char</span> cmd;                   <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Command: Commit (R)equest, (C)ommit Response, (A)bort, ...
</span><span class='linenum'>   78</span>     <span class="storage storage_type storage_type_c">int</span> opid;                   <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Operation identifier. On the Client-&gt;Server message it is -1
</span><span class='linenum'>   79</span>     <span class="storage storage_type storage_type_c">int</span> from;                   <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Msg coming from the server 'from'
</span><span class='linenum'>   80</span>     <span class="storage storage_type storage_type_c">int</span> to;                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Msg for the server 'to'
</span><span class='linenum'>   81</span> <span class="punctuation punctuation_definition punctuation_definition_invalid punctuation_definition_invalid_c++">}</span></span>;
<span class='linenum'>   82</span> 
<span class='linenum'>   83</span> <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">pending</span> <span class="punctuation punctuation_definition punctuation_definition_scope punctuation_definition_scope_c++">{</span>
<span class='linenum'>   84</span>     <span class="storage storage_type storage_type_c">int</span> opid;                   <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Operation identifier
</span><span class='linenum'>   85</span>     <span class="storage storage_type storage_type_c">int</span> status;                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Status of the operation: (1) if 2PC is initiated locally, (0) otherwise
</span><span class='linenum'>   86</span>     <span class="storage storage_type storage_type_c">int</span> pipe[<span class="constant constant_numeric constant_numeric_c">2</span>];                <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Pipe sides to communicate with the child handling the 2PC
</span><span class='linenum'>   87</span>     <span class="storage storage_type storage_type_c">int</span> client_socket_fd;       <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Socket FD to answer back to the client
</span><span class='linenum'>   88</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">couple</span> cpl</span>;          <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Operation to be performed
</span><span class='linenum'>   89</span>     <span class="storage storage_type storage_type_c">char</span> resp;                  <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Temporary value used during decision for Commit or Abort
</span><span class='linenum'>   90</span>     <span class="storage storage_type storage_type_c">int</span> pend;                   <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> How many servers have still to respond?
</span><span class='linenum'>   91</span>     <span class="storage storage_type storage_type_c">int</span> pid_child;              <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> PID of the child handling the 2PC
</span><span class='linenum'>   92</span>     <span class="support support_type support_type_sys-types support_type_sys-types_c">time_t</span> optime;              <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Time in which the operation entered the server
</span><span class='linenum'>   93</span> <span class="punctuation punctuation_definition punctuation_definition_invalid punctuation_definition_invalid_c++">}</span></span>;
<span class='linenum'>   94</span> 
<span class='linenum'>   95</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> GLOBAL VARIABLES
</span><span class='linenum'>   96</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>   97</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Declaring global lists:
</span><span class='linenum'>   98</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>     - replicalist, containing the list of servers belonging
</span><span class='linenum'>   99</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>                    to the distributed DB
</span><span class='linenum'>  100</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>     - pendinglist, containing a list of the operations which
</span><span class='linenum'>  101</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>                    are currently being distributed
</span><span class='linenum'>  102</span> 
<span class='linenum'>  103</span> list&lt;replica&gt; *replicalist = <span class="keyword keyword_control keyword_control_c++">new</span> list&lt;replica&gt;;
<span class='linenum'>  104</span> list&lt;pending&gt; *pendinglist = <span class="keyword keyword_control keyword_control_c++">new</span> list&lt;pending&gt;;
<span class='linenum'>  105</span> 
<span class='linenum'>  106</span> 
<span class='linenum'>  107</span> 
<span class='linenum'>  108</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> FUNCTIONS
</span><span class='linenum'>  109</span> 
<span class='linenum'>  110</span> 
<span class='linenum'>  111</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Compare function, to sort the list of servers by the ID server
</span><span class='linenum'>  112</span> 
<span class='linenum'>  113</span> <span class="storage storage_type storage_type_c">bool</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">compare_repid</span><span class="meta meta_parens meta_parens_c">(replica r1, replica r2)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  114</span>     <span class="keyword keyword_control keyword_control_c">if</span>(r1<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt; r2<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> )<span class="meta meta_block meta_block_c">{
<span class='linenum'>  115</span>         <span class="keyword keyword_control keyword_control_c">return</span> <span class="constant constant_language constant_language_c">true</span>;
<span class='linenum'>  116</span>     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  117</span>         <span class="keyword keyword_control keyword_control_c">return</span> <span class="constant constant_language constant_language_c">false</span>;
<span class='linenum'>  118</span>     }</span>
<span class='linenum'>  119</span>      
<span class='linenum'>  120</span> }</span></span>
<span class='linenum'>  121</span> 
<span class='linenum'>  122</span> 
<span class='linenum'>  123</span> 
<span class='linenum'>  124</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> void format_line(string FileLineID, string FileLineIP, string FileLinePort)
</span><span class='linenum'>  125</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  126</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The format_line function takes as input some parameters related to
</span><span class='linenum'>  127</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> a single DB server read from a single line of the servers file, and
</span><span class='linenum'>  128</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> appends them into the list of servers.
</span><span class='linenum'>  129</span> 
<span class='linenum'>  130</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">format_line</span><span class="meta meta_parens meta_parens_c">(string FileLineID, string FileLineIP, string FileLinePort)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  131</span>     
<span class='linenum'>  132</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating a temporary replica and filling it
</span><span class='linenum'>  133</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">replica</span> replica_temp</span>;
<span class='linenum'>  134</span>     replica_temp<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLineID.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  135</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">    </span><span class="support support_function support_function_C99 support_function_C99_c">strcpy</span>(replica_temp<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ip</span>,FileLineIP.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  136</span>     replica_temp<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.port</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLinePort.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  137</span>     
<span class='linenum'>  138</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Appending the new server to the list of db servers
</span><span class='linenum'>  139</span>     (*replicalist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">push_back</span>(</span>replica_temp);
<span class='linenum'>  140</span> 
<span class='linenum'>  141</span> }</span></span>
<span class='linenum'>  142</span> 
<span class='linenum'>  143</span> 
<span class='linenum'>  144</span> 
<span class='linenum'>  145</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> int read_file(list&lt;string&gt; iplist)
</span><span class='linenum'>  146</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  147</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function reads the list of servers from the file serverlist.txt
</span><span class='linenum'>  148</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> and puts this data into a local list of servers.
</span><span class='linenum'>  149</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The list is filled only at the server start.
</span><span class='linenum'>  150</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This list won't be changed, until the server will be killed and the
</span><span class='linenum'>  151</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> file newly read.
</span><span class='linenum'>  152</span> 
<span class='linenum'>  153</span> <span class="storage storage_type storage_type_c">int</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">read_file</span><span class="meta meta_parens meta_parens_c">(list&lt;string&gt; iplist)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  154</span> 
<span class='linenum'>  155</span>     <span class="storage storage_type storage_type_c">int</span> port = -<span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  156</span>     <span class="storage storage_type storage_type_c">bool</span> found = <span class="constant constant_language constant_language_c">false</span>; 
<span class='linenum'>  157</span>     
<span class='linenum'>  158</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Opening server list file
</span><span class='linenum'>  159</span>     ifstream<span class="meta meta_initialization meta_initialization_c"> <span class="variable variable_other variable_other_c">file</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>serverlist.txt<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  160</span> 
<span class='linenum'>  161</span>     string FileLineID;
<span class='linenum'>  162</span>     string FileLineIP;
<span class='linenum'>  163</span>     string FileLinePort;
<span class='linenum'>  164</span>     
<span class='linenum'>  165</span>     <span class="keyword keyword_control keyword_control_c">while</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>file) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  166</span>     
<span class='linenum'>  167</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Withdrawing server parameters from a single line of the servers file
</span><span class='linenum'>  168</span>         file &gt;&gt; FileLineID &gt;&gt; FileLineIP &gt;&gt; FileLinePort;
<span class='linenum'>  169</span>         
<span class='linenum'>  170</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span> !file ) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  171</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span> !file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">eof</span>(</span>) ) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  172</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  173</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error! Stream failure!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  174</span>             }</span>
<span class='linenum'>  175</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  176</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Passing the single line to the format_line function
</span><span class='linenum'>  177</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">            </span><span class="support support_function support_function_any-method support_function_any-method_c">format_line</span>(</span> FileLineID, FileLineIP, FileLinePort);
<span class='linenum'>  178</span>             
<span class='linenum'>  179</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>To find the port associated to ip of this machine
</span><span class='linenum'>  180</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>found == <span class="constant constant_language constant_language_c">false</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  181</span>                 <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;string&gt;::iterator it = iplist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=iplist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  182</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>cout &lt;&lt; "(*it) è " &lt;&lt; (*it) &lt;&lt; endl;
</span><span class='linenum'>  183</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>cout &lt;&lt; "FileLineIP è " &lt;&lt; FileLineIP &lt;&lt; endl;
</span><span class='linenum'>  184</span>                     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>FileLineIP==(*it)) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  185</span>                         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>cout &lt;&lt; "HO TROVATO LA PORTA\n";
</span><span class='linenum'>  186</span>                         found = <span class="constant constant_language constant_language_c">true</span>;
<span class='linenum'>  187</span>                         
<span class='linenum'>  188</span>                         port =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLinePort.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  189</span>                     }</span>
<span class='linenum'>  190</span>                 }</span>
<span class='linenum'>  191</span>             }</span>
<span class='linenum'>  192</span>         }</span>
<span class='linenum'>  193</span>     }</span>
<span class='linenum'>  194</span>     
<span class='linenum'>  195</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Closing server list file
</span><span class='linenum'>  196</span>     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  197</span>     <span class="keyword keyword_control keyword_control_c">return</span> port;
<span class='linenum'>  198</span> 
<span class='linenum'>  199</span> }</span></span>
<span class='linenum'>  200</span> 
<span class='linenum'>  201</span> 
<span class='linenum'>  202</span> 
<span class='linenum'>  203</span> 
<span class='linenum'>  204</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> void contact_host(struct db_msg messg, bool all)
</span><span class='linenum'>  205</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  206</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function is called whenever a packet should be sent, both
</span><span class='linenum'>  207</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> by the active or the passive side of the server.
</span><span class='linenum'>  208</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> It takes as input the message to send, and a boolean value,
</span><span class='linenum'>  209</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> used to specify if the message should be sent only to
</span><span class='linenum'>  210</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> a specific server (all=false) or to all the servers
</span><span class='linenum'>  211</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> (all=true).
</span><span class='linenum'>  212</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Everytime a new connection has to be set up, a new
</span><span class='linenum'>  213</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> child process is spawned.
</span><span class='linenum'>  214</span> 
<span class='linenum'>  215</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">contact_host</span><span class="meta meta_parens meta_parens_c">(<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>, <span class="storage storage_type storage_type_c">bool</span> all)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  216</span>     
<span class='linenum'>  217</span>     <span class="support support_type support_type_sys-types support_type_sys-types_c">pid_t</span> pid;
<span class='linenum'>  218</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">sockaddr_in</span> addr</span>;
<span class='linenum'>  219</span>     <span class="storage storage_type storage_type_c">int</span> sockfd;
<span class='linenum'>  220</span>     
<span class='linenum'>  221</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cs</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) || ((messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cs</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>S<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) &amp;&amp; (all == <span class="constant constant_language constant_language_c">false</span>))) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  222</span>         
<span class='linenum'>  223</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the message needs to be sent only to one server, a single
</span><span class='linenum'>  224</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> child is spawned.
</span><span class='linenum'>  225</span>         
<span class='linenum'>  226</span>         pid =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">fork</span>(</span>);
<span class='linenum'>  227</span>         
<span class='linenum'>  228</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>pid &lt; <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  229</span>             
<span class='linenum'>  230</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  231</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">            </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  232</span>             
<span class='linenum'>  233</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  234</span>             
<span class='linenum'>  235</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>pid == <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  236</span>                 
<span class='linenum'>  237</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the message needs to be sent to the CLIENT, the messg.from field
</span><span class='linenum'>  238</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> contains the identifier of the socket still open since the time
</span><span class='linenum'>  239</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> in which the client request has been received.
</span><span class='linenum'>  240</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Only a send (and the socket closing) should be performed.
</span><span class='linenum'>  241</span>                 
<span class='linenum'>  242</span>                 <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cs</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  243</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">send</span>(</span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span>, (<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span>*</span>) &amp;messg,<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span>(</span>db_msg),<span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'>  244</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span>);
<span class='linenum'>  245</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                    </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'>  246</span>                     
<span class='linenum'>  247</span>                 }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  248</span>                     
<span class='linenum'>  249</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the message needs to be sent to another server...
</span><span class='linenum'>  250</span>                     
<span class='linenum'>  251</span>                     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;replica&gt;::iterator it = (*replicalist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=(*replicalist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  252</span>                         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Searching fot the IP and port of the recipient server...
</span><span class='linenum'>  253</span>                         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.to</span> == (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  254</span>                             addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_family</span> = AF_INET;
<span class='linenum'>  255</span>                             addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_addr.s_addr</span> =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">inet_addr</span>(</span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ip</span>);
<span class='linenum'>  256</span>                             addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_port</span> =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">htons</span>(</span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.port</span>);
<span class='linenum'>  257</span>                             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  258</span>                         }</span>
<span class='linenum'>  259</span>                     }</span>
<span class='linenum'>  260</span>                     
<span class='linenum'>  261</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the socket
</span><span class='linenum'>  262</span>                     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(sockfd =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">socket</span>(</span>AF_INET, SOCK_STREAM, IPPROTO_TCP))&lt;<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  263</span>                         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  264</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                        </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  265</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">2</span>);
<span class='linenum'>  266</span>                     }</span>
<span class='linenum'>  267</span>                     
<span class='linenum'>  268</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Trying to connect to the server
</span><span class='linenum'>  269</span>                     <span class="storage storage_type storage_type_c">int</span> err =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">connect</span>(</span>sockfd, (<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">sockaddr</span> *</span>) &amp;addr,<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span>(</span>addr));
<span class='linenum'>  270</span>                     <span class="keyword keyword_control keyword_control_c">if</span>(err != <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  271</span>                         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  272</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                        </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  273</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                        </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>sockfd);
<span class='linenum'>  274</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">3</span>);        
<span class='linenum'>  275</span>                     }</span>
<span class='linenum'>  276</span> 
<span class='linenum'>  277</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Sending the operation to the host
</span><span class='linenum'>  278</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">send</span> (</span>sockfd, (<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span>*</span>) &amp;messg,<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span>(</span>db_msg), <span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'>  279</span>                     
<span class='linenum'>  280</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Closing socket
</span><span class='linenum'>  281</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>sockfd);
<span class='linenum'>  282</span>                 }</span>
<span class='linenum'>  283</span>                 
<span class='linenum'>  284</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'>  285</span>             }</span>
<span class='linenum'>  286</span>         }</span>
<span class='linenum'>  287</span>             
<span class='linenum'>  288</span>     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  289</span>         
<span class='linenum'>  290</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the message needs to be sent to all other servers (all=true), then a new
</span><span class='linenum'>  291</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> child is spawned for every server, the message sent, and then every child
</span><span class='linenum'>  292</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> will suicide. :)
</span><span class='linenum'>  293</span>         
<span class='linenum'>  294</span>         <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;replica&gt;::iterator it = (*replicalist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=(*replicalist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  295</span>             
<span class='linenum'>  296</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> One fork for every server
</span><span class='linenum'>  297</span>             pid =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">fork</span>(</span>);
<span class='linenum'>  298</span>             
<span class='linenum'>  299</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>pid &lt; <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  300</span>                 
<span class='linenum'>  301</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  302</span> 
<span class='linenum'>  303</span>             }</span><span class="keyword keyword_control keyword_control_c">else</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  304</span>                 
<span class='linenum'>  305</span>                 <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>pid == <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  306</span>                     addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_family</span> = AF_INET;
<span class='linenum'>  307</span>                     addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_addr.s_addr</span> =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">inet_addr</span>(</span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ip</span>);
<span class='linenum'>  308</span>                     addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_port</span> =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">htons</span>(</span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.port</span>);
<span class='linenum'>  309</span>                     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Into contact_host. messg.cs is <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cs</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> and all is <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; all &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>. Trying to connect to IP <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ip</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> and port <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.port</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> messg.cmd is <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> messg.cpl.operation is <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.operation</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>, messg.cpl.key is <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> and messg.cpl.value is <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.value</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> and pidB is <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt;<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">getpid</span>(</span>) &lt;&lt; endl;
<span class='linenum'>  310</span>                     
<span class='linenum'>  311</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the socket
</span><span class='linenum'>  312</span>                     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(sockfd =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">socket</span>(</span>AF_INET, SOCK_STREAM, IPPROTO_TCP))&lt;<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  313</span>                         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  314</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                        </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  315</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">2</span>);
<span class='linenum'>  316</span>                     }</span>
<span class='linenum'>  317</span>                     
<span class='linenum'>  318</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Trying to connect to the host
</span><span class='linenum'>  319</span>                     <span class="storage storage_type storage_type_c">int</span> err =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">connect</span>(</span>sockfd, (<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">sockaddr</span> *</span>) &amp;addr,<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span>(</span>addr));
<span class='linenum'>  320</span>                     <span class="keyword keyword_control keyword_control_c">if</span>(err != <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  321</span>                         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  322</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                        </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  323</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                        </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>sockfd);
<span class='linenum'>  324</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">3</span>);        
<span class='linenum'>  325</span>                     }</span>
<span class='linenum'>  326</span>                     
<span class='linenum'>  327</span>                     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.to</span> = (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span>;
<span class='linenum'>  328</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Sending the operation to the host
</span><span class='linenum'>  329</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">send</span> (</span>sockfd, (<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span>*</span>) &amp;messg,<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span>(</span>db_msg), <span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'>  330</span>                     
<span class='linenum'>  331</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Closing socket
</span><span class='linenum'>  332</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>sockfd);
<span class='linenum'>  333</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                    </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'>  334</span>                 }</span>
<span class='linenum'>  335</span>             }</span>
<span class='linenum'>  336</span>         }</span>
<span class='linenum'>  337</span>     }</span>
<span class='linenum'>  338</span> }</span></span>
<span class='linenum'>  339</span> 
<span class='linenum'>  340</span> 
<span class='linenum'>  341</span> 
<span class='linenum'>  342</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> struct couple perform_operation(struct couple record)
</span><span class='linenum'>  343</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  344</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function starts the 2PC commit process, and then waits
</span><span class='linenum'>  345</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> for the messages to be received by the father and written
</span><span class='linenum'>  346</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> into the pipe.
</span><span class='linenum'>  347</span> 
<span class='linenum'>  348</span> <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">couple</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">perform_operation</span><span class="meta meta_parens meta_parens_c">(<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">couple</span> record</span>)</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  349</span> 
<span class='linenum'>  350</span>     fstream file;
<span class='linenum'>  351</span>     string FileLineKey, FileLineValue;
<span class='linenum'>  352</span>     <span class="storage storage_type storage_type_c">bool</span> find = <span class="constant constant_numeric constant_numeric_c">0</span>;
<span class='linenum'>  353</span>     list&lt;couple&gt; dblist;
<span class='linenum'>  354</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">couple</span> db_temp</span>;
<span class='linenum'>  355</span>     
<span class='linenum'>  356</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> -- Writing Operation <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> on key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> into Stable Storage...<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  357</span>     
<span class='linenum'>  358</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Is this (I)nsert, (Q)uery or (D)elete?
</span><span class='linenum'>  359</span>     <span class="keyword keyword_control keyword_control_c">switch</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  360</span>         
<span class='linenum'>  361</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> INSERT operation
</span><span class='linenum'>  362</span>         <span class="keyword keyword_control keyword_control_c">case</span> <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>I<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>:
<span class='linenum'>  363</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Opening the file db.txt
</span><span class='linenum'>  364</span>             file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">open</span>(</span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>db.txt<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>, ios::in);
<span class='linenum'>  365</span>             
<span class='linenum'>  366</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>!file) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  367</span>                 
<span class='linenum'>  368</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the file doesn't exist, it is created and the operation inserted
</span><span class='linenum'>  369</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> into the first row
</span><span class='linenum'>  370</span>                 file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  371</span>                 file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">open</span> (</span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>db.txt<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>, ios::out);
<span class='linenum'>  372</span>                 file &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span>;
<span class='linenum'>  373</span>                 file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  374</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  375</span>                 
<span class='linenum'>  376</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the file exists, every row of the file is read, and put into a temporary
</span><span class='linenum'>  377</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> list of records (key,value), so the file is copied into the RAM
</span><span class='linenum'>  378</span>                 <span class="keyword keyword_control keyword_control_c">while</span>(!file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">eof</span>(</span>))<span class="meta meta_block meta_block_c">{
<span class='linenum'>  379</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> A single row is read
</span><span class='linenum'>  380</span>                     file &gt;&gt; FileLineKey &gt;&gt; FileLineValue;
<span class='linenum'>  381</span>                     
<span class='linenum'>  382</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Conversion
</span><span class='linenum'>  383</span>                     db_temp<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLineKey.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  384</span>                     db_temp<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLineValue.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  385</span>                     dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">push_back</span>(</span>db_temp);
<span class='linenum'>  386</span>                     
<span class='linenum'>  387</span>                     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>db_temp<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> == record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  388</span>                         find = <span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  389</span>                     }</span>
<span class='linenum'>  390</span>                 }</span>
<span class='linenum'>  391</span>                         
<span class='linenum'>  392</span>                 <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>find!=<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  393</span>                     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  394</span>                     
<span class='linenum'>  395</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Overwriting the entire file db.txt
</span><span class='linenum'>  396</span>                     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">open</span>(</span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>db.txt<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>, ios::out);
<span class='linenum'>  397</span>                     
<span class='linenum'>  398</span>                     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;couple&gt;::iterator it = dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  399</span>                         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> != record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  400</span>                             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>it==dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>)) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  401</span>                                 file &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span>;
<span class='linenum'>  402</span>                             }</span><span class="keyword keyword_control keyword_control_c">else</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  403</span>                                 file &lt;&lt; endl &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span>;
<span class='linenum'>  404</span>                             }</span>
<span class='linenum'>  405</span>                         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  406</span>                             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Here the modified row is written
</span><span class='linenum'>  407</span>                             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>it==dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>)) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  408</span>                                 file &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span>;
<span class='linenum'>  409</span>                             }</span><span class="keyword keyword_control keyword_control_c">else</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  410</span>                                 file &lt;&lt; endl &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span>;
<span class='linenum'>  411</span>                             }</span>
<span class='linenum'>  412</span>                         }</span>
<span class='linenum'>  413</span>                     }</span>
<span class='linenum'>  414</span>                     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  415</span>                     
<span class='linenum'>  416</span>                 }</span><span class="keyword keyword_control keyword_control_c">else</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  417</span>                     
<span class='linenum'>  418</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If an old entry for the key is not found in the file, the local copy is destroyed and
</span><span class='linenum'>  419</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> the new operation is appended at the end of the file.
</span><span class='linenum'>  420</span>                     dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">erase</span>(</span>dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>),dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>)); 
<span class='linenum'>  421</span>                     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  422</span>                     
<span class='linenum'>  423</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Opening the file in append mode (append the new row at the bottom of the file)
</span><span class='linenum'>  424</span>                     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">open</span> (</span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>db.txt<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>, ios::app | ios::out);
<span class='linenum'>  425</span>                     
<span class='linenum'>  426</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the file is empty, the "endl" is not used
</span><span class='linenum'>  427</span>                     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>FileLineKey==<span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  428</span>                         file &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span>;
<span class='linenum'>  429</span>                     }</span><span class="keyword keyword_control keyword_control_c">else</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  430</span>                         file &lt;&lt; endl &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span>;
<span class='linenum'>  431</span>                     }</span>
<span class='linenum'>  432</span>                     
<span class='linenum'>  433</span>                     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  434</span>                 }</span>
<span class='linenum'>  435</span>                 
<span class='linenum'>  436</span>             }</span>
<span class='linenum'>  437</span>             
<span class='linenum'>  438</span>             cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> -- OK! Operation <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> on key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> written into Stable Storage!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  439</span>             
<span class='linenum'>  440</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the operation is succesfull, a message is sent back with a C in the field operation
</span><span class='linenum'>  441</span>             record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  442</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  443</span> 
<span class='linenum'>  444</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> QUERY operation
</span><span class='linenum'>  445</span>         <span class="keyword keyword_control keyword_control_c">case</span> <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>Q<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>:
<span class='linenum'>  446</span>             
<span class='linenum'>  447</span>             file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">open</span> (</span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>db.txt<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>, ios::in);
<span class='linenum'>  448</span>             
<span class='linenum'>  449</span>             <span class="keyword keyword_control keyword_control_c">while</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>file) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  450</span>                 
<span class='linenum'>  451</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Withdrawing server parameters from a single line of the servers file
</span><span class='linenum'>  452</span>                 file &gt;&gt; FileLineKey &gt;&gt; FileLineValue;
<span class='linenum'>  453</span>                 
<span class='linenum'>  454</span>                 <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span> !file ) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  455</span>                     
<span class='linenum'>  456</span>                     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span> !file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">eof</span>(</span>) ) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  457</span>                         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  458</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                        </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error! Stream failure!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  459</span>                     }</span>
<span class='linenum'>  460</span>                     
<span class='linenum'>  461</span>                 }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  462</span>                     
<span class='linenum'>  463</span>                     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLineKey.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>)) == record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  464</span>                         find = <span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  465</span>                         record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLineKey.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  466</span>                         record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLineValue.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  467</span>                         record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  468</span>                         <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  469</span>                     }</span>
<span class='linenum'>  470</span>                     
<span class='linenum'>  471</span>                 }</span>
<span class='linenum'>  472</span>             }</span>
<span class='linenum'>  473</span>             
<span class='linenum'>  474</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the key is not found...
</span><span class='linenum'>  475</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>find==<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  476</span>                 cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>-- WARNING! Query of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> not performed, since key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> is not in the DB!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  477</span>                 record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>A<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  478</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  479</span>                 cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> -- OK! Operation <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> on key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> performed!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  480</span>             }</span>
<span class='linenum'>  481</span>             
<span class='linenum'>  482</span>             file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  483</span>             
<span class='linenum'>  484</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  485</span> 
<span class='linenum'>  486</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> DELETE operation
</span><span class='linenum'>  487</span>         <span class="keyword keyword_control keyword_control_c">case</span> <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>D<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>:
<span class='linenum'>  488</span>         
<span class='linenum'>  489</span>             file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">open</span>(</span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>db.txt<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>, ios::in);
<span class='linenum'>  490</span>             
<span class='linenum'>  491</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>!file) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  492</span>                 
<span class='linenum'>  493</span>                 file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  494</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  495</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>break;
</span><span class='linenum'>  496</span>                 
<span class='linenum'>  497</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  498</span>                 
<span class='linenum'>  499</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the file exists, every row of the file is read, and put into a temporary
</span><span class='linenum'>  500</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> list of records (key,value), so the file is copied into the RAM.
</span><span class='linenum'>  501</span>                 <span class="keyword keyword_control keyword_control_c">while</span>(!file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">eof</span>(</span>))<span class="meta meta_block meta_block_c">{
<span class='linenum'>  502</span>                     file &gt;&gt; FileLineKey &gt;&gt; FileLineValue;
<span class='linenum'>  503</span>                     
<span class='linenum'>  504</span>                     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLineKey.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>)) == record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  505</span>                         find = <span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  506</span>                     }</span><span class="keyword keyword_control keyword_control_c">else</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  507</span>                         db_temp<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLineKey.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  508</span>                         db_temp<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLineValue.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  509</span>                         dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">push_back</span>(</span>db_temp);                  
<span class='linenum'>  510</span>                     }</span>
<span class='linenum'>  511</span>                 }</span>
<span class='linenum'>  512</span>                         
<span class='linenum'>  513</span>                 <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>find!=<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  514</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the key has been found...
</span><span class='linenum'>  515</span>                     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  516</span>                     
<span class='linenum'>  517</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> File is open in write mode and the temporary list written back to
</span><span class='linenum'>  518</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> the file
</span><span class='linenum'>  519</span>                     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">open</span>(</span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>db.txt<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>, ios::out);
<span class='linenum'>  520</span>                     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;couple&gt;::iterator it = dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  521</span>                         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>it==dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>)) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  522</span>                             file &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span>;
<span class='linenum'>  523</span>                         }</span><span class="keyword keyword_control keyword_control_c">else</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  524</span>                             file &lt;&lt; endl &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.value</span>;
<span class='linenum'>  525</span>                         }</span>
<span class='linenum'>  526</span>                     }</span>
<span class='linenum'>  527</span>                     
<span class='linenum'>  528</span>                     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> -- OK! Operation <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> on key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> written into Stable Storage!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  529</span>                     
<span class='linenum'>  530</span>                     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  531</span>                     
<span class='linenum'>  532</span>                 }</span><span class="keyword keyword_control keyword_control_c">else</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  533</span>                     
<span class='linenum'>  534</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the key has not been found, everything is ok, since this is a Delete, and
</span><span class='linenum'>  535</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> the software behaves as if the key would have been found and successfully deleted.
</span><span class='linenum'>  536</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> In this case, only a Warning message is printed on the Server output.
</span><span class='linenum'>  537</span>                     
<span class='linenum'>  538</span>                     dblist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">clear</span>(</span>); 
<span class='linenum'>  539</span>                     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>-- WARNING! Delete of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> not performed, since key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> is not in the DB!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  540</span>                     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  541</span>                     
<span class='linenum'>  542</span>                 }</span>
<span class='linenum'>  543</span>                 
<span class='linenum'>  544</span>             }</span>
<span class='linenum'>  545</span>             
<span class='linenum'>  546</span>             record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  547</span>             
<span class='linenum'>  548</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  549</span> 
<span class='linenum'>  550</span>     }</span>
<span class='linenum'>  551</span> 
<span class='linenum'>  552</span>     <span class="keyword keyword_control keyword_control_c">return</span> record;
<span class='linenum'>  553</span> }</span></span></span>
<span class='linenum'>  554</span> 
<span class='linenum'>  555</span> 
<span class='linenum'>  556</span> 
<span class='linenum'>  557</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> void agreement_start(struct db_msg messg)
</span><span class='linenum'>  558</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  559</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function starts the 2PC commit process, and then waits
</span><span class='linenum'>  560</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> for the messages to be received by the father and written
</span><span class='linenum'>  561</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> into the pipe.
</span><span class='linenum'>  562</span> 
<span class='linenum'>  563</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">agreement_start</span><span class="meta meta_parens meta_parens_c">(<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  564</span>     
<span class='linenum'>  565</span>     <span class="support support_type support_type_sys-types support_type_sys-types_c">pid_t</span> pid;
<span class='linenum'>  566</span>     <span class="storage storage_type storage_type_c">int</span> pipesides[<span class="constant constant_numeric constant_numeric_c">2</span>];
<span class='linenum'>  567</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">pending</span> agr</span>;
<span class='linenum'>  568</span>     <span class="storage storage_type storage_type_c">char</span> resp;
<span class='linenum'>  569</span>     
<span class='linenum'>  570</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> --- START of 2 phase commit for <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.operation</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> on key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; endl;
<span class='linenum'>  571</span>     
<span class='linenum'>  572</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Assigning a random identifier for this operation
</span><span class='linenum'>  573</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span> =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">random</span>(</span>);
<span class='linenum'>  574</span>         
<span class='linenum'>  575</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating pipes to communicate with father process and putting this operation
</span><span class='linenum'>  576</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> into the list of pending operations.
</span><span class='linenum'>  577</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">    </span><span class="support support_function support_function_any-method support_function_any-method_c">pipe</span>(</span>pipesides);
<span class='linenum'>  578</span>     agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span> = messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>;
<span class='linenum'>  579</span>     agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl</span> = messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl</span>;
<span class='linenum'>  580</span>     agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pipe</span>[<span class="constant constant_numeric constant_numeric_c">0</span>] = pipesides[<span class="constant constant_numeric constant_numeric_c">0</span>];
<span class='linenum'>  581</span>     agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pipe</span>[<span class="constant constant_numeric constant_numeric_c">1</span>] = pipesides[<span class="constant constant_numeric constant_numeric_c">1</span>];
<span class='linenum'>  582</span>     agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.resp</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  583</span>     agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pend</span> = (*replicalist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">size</span>(</span>);
<span class='linenum'>  584</span>     agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.status</span> = <span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  585</span>     agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.client_socket_fd</span> = messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span>;
<span class='linenum'>  586</span>     agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.optime</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">time</span>(<span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'>  587</span>     
<span class='linenum'>  588</span>     (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">push_back</span>(</span>agr);
<span class='linenum'>  589</span>     
<span class='linenum'>  590</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Spawning a new child responsible for this specific operation
</span><span class='linenum'>  591</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cs</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>S<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  592</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span> = messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.to</span>;
<span class='linenum'>  593</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>R<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  594</span>     
<span class='linenum'>  595</span>     pid =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">fork</span>(</span>);
<span class='linenum'>  596</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>pid &lt; <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  597</span>         
<span class='linenum'>  598</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  599</span>         
<span class='linenum'>  600</span>     }</span><span class="keyword keyword_control keyword_control_c">else</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  601</span>         
<span class='linenum'>  602</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>pid == <span class="constant constant_numeric constant_numeric_c">0</span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  603</span>             
<span class='linenum'>  604</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">            </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">back</span>(</span>)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.client_socket_fd</span>);
<span class='linenum'>  605</span>             
<span class='linenum'>  606</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The contact_host function will spawn 
</span><span class='linenum'>  607</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> many new children, one for every other server, and make them issue
</span><span class='linenum'>  608</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> a Commit Request (R) to each other server (including the passive side
</span><span class='linenum'>  609</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> of the current one)
</span><span class='linenum'>  610</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">            </span><span class="support support_function support_function_any-method support_function_any-method_c">contact_host</span>(</span>messg, <span class="constant constant_language constant_language_c">true</span>);
<span class='linenum'>  611</span>             
<span class='linenum'>  612</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Waiting for the Global Decision to be written into the pipe
</span><span class='linenum'>  613</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> by the father. This decision will be written once the father
</span><span class='linenum'>  614</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> has received all the response from all other servers.
</span><span class='linenum'>  615</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">            </span><span class="support support_function support_function_any-method support_function_any-method_c">read</span>(</span>pipesides[<span class="constant constant_numeric constant_numeric_c">0</span>],&amp;resp,<span class="constant constant_numeric constant_numeric_c">1</span>);
<span class='linenum'>  616</span> 
<span class='linenum'>  617</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the decision is a Commit (C), then the message to send to all other
</span><span class='linenum'>  618</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> server is a Global Commit (K), otherways it is a Global Abort (N)
</span><span class='linenum'>  619</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>resp == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  620</span>                 messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>K<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  621</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  622</span>                 messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>N<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  623</span>             }</span>
<span class='linenum'>  624</span>             
<span class='linenum'>  625</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The contact_host function will spawn 
</span><span class='linenum'>  626</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> many new children, one for every other server, and make them issue
</span><span class='linenum'>  627</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> the decision (K/N) to each other server (including the passive side
</span><span class='linenum'>  628</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> of the current one)
</span><span class='linenum'>  629</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">            </span><span class="support support_function support_function_any-method support_function_any-method_c">contact_host</span>(</span>messg, <span class="constant constant_language constant_language_c">true</span>);
<span class='linenum'>  630</span>             
<span class='linenum'>  631</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The pipe is closed and the current child killed
</span><span class='linenum'>  632</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">            </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>pipesides[<span class="constant constant_numeric constant_numeric_c">0</span>]);
<span class='linenum'>  633</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">            </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>pipesides[<span class="constant constant_numeric constant_numeric_c">1</span>]);
<span class='linenum'>  634</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">            </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'>  635</span>             
<span class='linenum'>  636</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  637</span>             
<span class='linenum'>  638</span>             (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">back</span>(</span>)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pid_child</span> = pid;      
<span class='linenum'>  639</span>                 
<span class='linenum'>  640</span>         }</span>
<span class='linenum'>  641</span>         
<span class='linenum'>  642</span>     }</span>
<span class='linenum'>  643</span>     
<span class='linenum'>  644</span> }</span></span>
<span class='linenum'>  645</span> 
<span class='linenum'>  646</span> 
<span class='linenum'>  647</span> 
<span class='linenum'>  648</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> bool check_correct_server(struct db_msg messg)
</span><span class='linenum'>  649</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  650</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function checks if this is the authoritative server
</span><span class='linenum'>  651</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> for the received operation.
</span><span class='linenum'>  652</span> 
<span class='linenum'>  653</span> <span class="storage storage_type storage_type_c">bool</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">check_correct_server</span><span class="meta meta_parens meta_parens_c">(<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  654</span>     
<span class='linenum'>  655</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">replica</span> server</span>;
<span class='linenum'>  656</span>     server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> = -<span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  657</span>     
<span class='linenum'>  658</span>     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;replica&gt;::iterator it = (*replicalist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=(*replicalist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  659</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt;= messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  660</span>             server = (*it);
<span class='linenum'>  661</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  662</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  663</span>         }</span>
<span class='linenum'>  664</span>     }</span>
<span class='linenum'>  665</span>     
<span class='linenum'>  666</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> != messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.to</span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  667</span>         <span class="keyword keyword_control keyword_control_c">return</span> <span class="constant constant_language constant_language_c">false</span>;
<span class='linenum'>  668</span>     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  669</span>         <span class="keyword keyword_control keyword_control_c">return</span> <span class="constant constant_language constant_language_c">true</span>;
<span class='linenum'>  670</span>     }</span>
<span class='linenum'>  671</span>     
<span class='linenum'>  672</span> }</span></span>
<span class='linenum'>  673</span> 
<span class='linenum'>  674</span> 
<span class='linenum'>  675</span> 
<span class='linenum'>  676</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> bool find_active(int key, int opid)
</span><span class='linenum'>  677</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  678</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function is used whenever we want to know if any operation
</span><span class='linenum'>  679</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> on a specific key is already undergoing execution.
</span><span class='linenum'>  680</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If an operation on a specific key is received by the server from
</span><span class='linenum'>  681</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> a client, and if another operation on the same key is currently
</span><span class='linenum'>  682</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> being served by the Distributed DB, the newly received operation
</span><span class='linenum'>  683</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> should be aborted.
</span><span class='linenum'>  684</span> 
<span class='linenum'>  685</span> <span class="storage storage_type storage_type_c">bool</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">find_active</span><span class="meta meta_parens meta_parens_c">(<span class="storage storage_type storage_type_c">int</span> key, <span class="storage storage_type storage_type_c">int</span> opid)</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  686</span> 
<span class='linenum'>  687</span>     <span class="storage storage_type storage_type_c">bool</span> found = <span class="constant constant_language constant_language_c">false</span>;
<span class='linenum'>  688</span>     
<span class='linenum'>  689</span>     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;pending&gt;::iterator it = (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  690</span>         
<span class='linenum'>  691</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span>==key) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  692</span>             
<span class='linenum'>  693</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the Pending List already contains an entry with the same key...
</span><span class='linenum'>  694</span>             
<span class='linenum'>  695</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>opid==-<span class="constant constant_numeric constant_numeric_c">1</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  696</span>                 
<span class='linenum'>  697</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the message arrived is a Query operation and it is just 
</span><span class='linenum'>  698</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> arrived from a client, then another operation in the server
</span><span class='linenum'>  699</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> on the same key means that the new operation should be
</span><span class='linenum'>  700</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> aborted (return True).
</span><span class='linenum'>  701</span>                 
<span class='linenum'>  702</span>                 found = <span class="constant constant_language constant_language_c">true</span>;
<span class='linenum'>  703</span>                 <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  704</span>                 
<span class='linenum'>  705</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  706</span>                 
<span class='linenum'>  707</span>                 <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>!=opid) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  708</span>                     
<span class='linenum'>  709</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the Operation is contained in the Pending List,
</span><span class='linenum'>  710</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> and the OpID between the two is different, this function
</span><span class='linenum'>  711</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> returns True.
</span><span class='linenum'>  712</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The check on the OpID is performed to handle the situation
</span><span class='linenum'>  713</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> in which the active server sends the Commit Request to
</span><span class='linenum'>  714</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> himself, too. The Pending List already contains an item,
</span><span class='linenum'>  715</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> pushed back by the active part. This entry is related to
</span><span class='linenum'>  716</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> the same operation, so it's not related to another
</span><span class='linenum'>  717</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> operation, even if it is already in the Pending List.
</span><span class='linenum'>  718</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> In this case it returns False, in all the other cases,
</span><span class='linenum'>  719</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> True.
</span><span class='linenum'>  720</span>                     
<span class='linenum'>  721</span>                     found = <span class="constant constant_language constant_language_c">true</span>;
<span class='linenum'>  722</span>                     <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  723</span>                     
<span class='linenum'>  724</span>                 }</span>
<span class='linenum'>  725</span>                 
<span class='linenum'>  726</span>             }</span>
<span class='linenum'>  727</span>             
<span class='linenum'>  728</span>         }</span>
<span class='linenum'>  729</span>         
<span class='linenum'>  730</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">size</span>(</span>)==<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  731</span>     }</span>
<span class='linenum'>  732</span>     
<span class='linenum'>  733</span>     <span class="keyword keyword_control keyword_control_c">return</span> found;
<span class='linenum'>  734</span> }</span></span>
<span class='linenum'>  735</span> 
<span class='linenum'>  736</span> 
<span class='linenum'>  737</span> 
<span class='linenum'>  738</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> handle_client(struct db_msg messg)
</span><span class='linenum'>  739</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  740</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function is used if the packet received by the server
</span><span class='linenum'>  741</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> is coming from the client.
</span><span class='linenum'>  742</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Based on the operation the client wants to perform,
</span><span class='linenum'>  743</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> different actions are taken.
</span><span class='linenum'>  744</span> 
<span class='linenum'>  745</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">handle_client</span><span class="meta meta_parens meta_parens_c">(<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  746</span> 
<span class='linenum'>  747</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">couple</span> temp_record</span>;
<span class='linenum'>  748</span>     
<span class='linenum'>  749</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.operation</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>Q<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) || (messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.operation</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>I<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) || (messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.operation</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>D<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>)) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  750</span>         
<span class='linenum'>  751</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If this is a QUERY...
</span><span class='linenum'>  752</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.operation</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>Q<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  753</span>             
<span class='linenum'>  754</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Check if another operation is taking place on the same key
</span><span class='linenum'>  755</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> (otherways, Abort!)
</span><span class='linenum'>  756</span>             <span class="keyword keyword_control keyword_control_c">if</span>(!<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">find_active</span>(</span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span>,messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>)) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  757</span>                 
<span class='linenum'>  758</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Performing the read in the database
</span><span class='linenum'>  759</span>                 temp_record =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">perform_operation</span>(</span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl</span>);
<span class='linenum'>  760</span>                 
<span class='linenum'>  761</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Packing the result, if the key is found
</span><span class='linenum'>  762</span>                 <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>temp_record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span>==<span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  763</span>                     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl</span> = temp_record;
<span class='linenum'>  764</span>                     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>K<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  765</span>                     
<span class='linenum'>  766</span>                 }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  767</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the key is not found, an 'ABSENT' message is sent
</span><span class='linenum'>  768</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> back to the client
</span><span class='linenum'>  769</span>                     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>temp_record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span>==<span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>A<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  770</span>                         messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>A<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  771</span>                     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  772</span>                         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  773</span>                         cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! The operation is not successful<span class="constant constant_character constant_character_escape constant_character_escape_c">\n</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>; 
<span class='linenum'>  774</span>                         messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>N<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  775</span>                     }</span>
<span class='linenum'>  776</span>                 }</span>
<span class='linenum'>  777</span>                 
<span class='linenum'>  778</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  779</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  780</span>                 cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! Another operation is taking place on this key!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  781</span>                 messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>N<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;                
<span class='linenum'>  782</span>             }</span>
<span class='linenum'>  783</span>             
<span class='linenum'>  784</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  785</span>             
<span class='linenum'>  786</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If this is an INSERT or a DELETE, check if the current is the correct server
</span><span class='linenum'>  787</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">check_correct_server</span>(</span>messg)) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  788</span>                 
<span class='linenum'>  789</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Check if another operation is taking place on the same key
</span><span class='linenum'>  790</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> (otherways, Abort!)
</span><span class='linenum'>  791</span>                 <span class="keyword keyword_control keyword_control_c">if</span>(!<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">find_active</span>(</span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span>,messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>)) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  792</span>                     
<span class='linenum'>  793</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Start 2 phase commit
</span><span class='linenum'>  794</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">agreement_start</span>(</span>messg);
<span class='linenum'>  795</span>                     <span class="keyword keyword_control keyword_control_c">return</span>;
<span class='linenum'>  796</span>                     
<span class='linenum'>  797</span>                 }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  798</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Key is going to be updated
</span><span class='linenum'>  799</span>                     cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! Another operation is taking place on this key!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  800</span>                     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>N<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  801</span> 
<span class='linenum'>  802</span>                 }</span>
<span class='linenum'>  803</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  804</span>                 
<span class='linenum'>  805</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The client contacted the Wrong (W) server!
</span><span class='linenum'>  806</span>                 messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>W<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  807</span>                 
<span class='linenum'>  808</span>             }</span>
<span class='linenum'>  809</span>             
<span class='linenum'>  810</span>         }</span>
<span class='linenum'>  811</span>         
<span class='linenum'>  812</span>     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  813</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The command is neither Q, D or I
</span><span class='linenum'>  814</span>         messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>N<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  815</span>     }</span>
<span class='linenum'>  816</span>     
<span class='linenum'>  817</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Sending back the reponse to the client
</span><span class='linenum'>  818</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">    </span><span class="support support_function support_function_any-method support_function_any-method_c">contact_host</span>(</span>messg, <span class="constant constant_language constant_language_c">false</span>);
<span class='linenum'>  819</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">    </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span>);
<span class='linenum'>  820</span>     
<span class='linenum'>  821</span> }</span></span>
<span class='linenum'>  822</span> 
<span class='linenum'>  823</span> 
<span class='linenum'>  824</span> 
<span class='linenum'>  825</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> bool find_operation(int opid)
</span><span class='linenum'>  826</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  827</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function is used whenever we want to know if a specified Operation
</span><span class='linenum'>  828</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> is contained in the pending list.
</span><span class='linenum'>  829</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The search is performed by looking at the Operation identifier opid.
</span><span class='linenum'>  830</span> 
<span class='linenum'>  831</span> <span class="storage storage_type storage_type_c">bool</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">find_operation</span><span class="meta meta_parens meta_parens_c">(<span class="storage storage_type storage_type_c">int</span> opid)</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  832</span> 
<span class='linenum'>  833</span>     <span class="storage storage_type storage_type_c">bool</span> found = <span class="constant constant_language constant_language_c">false</span>;
<span class='linenum'>  834</span>     
<span class='linenum'>  835</span>     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;pending&gt;::iterator it = (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  836</span>         
<span class='linenum'>  837</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>==opid) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  838</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the specified operation is found, it returns True,
</span><span class='linenum'>  839</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> otherway it returns False.
</span><span class='linenum'>  840</span>             found = <span class="constant constant_language constant_language_c">true</span>;
<span class='linenum'>  841</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  842</span>         }</span>
<span class='linenum'>  843</span>         
<span class='linenum'>  844</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">size</span>(</span>)==<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  845</span>         
<span class='linenum'>  846</span>     }</span>
<span class='linenum'>  847</span>     
<span class='linenum'>  848</span>     <span class="keyword keyword_control keyword_control_c">return</span> found;
<span class='linenum'>  849</span>     
<span class='linenum'>  850</span> }</span></span>
<span class='linenum'>  851</span> 
<span class='linenum'>  852</span> 
<span class='linenum'>  853</span> 
<span class='linenum'>  854</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> void handle_commit_request(struct db_msg messg)
</span><span class='linenum'>  855</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  856</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function is called on the passive side whenever a Commit Request
</span><span class='linenum'>  857</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> is received from an active server. The caller function, before
</span><span class='linenum'>  858</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> calling handle_commit_request, first performs a check if another
</span><span class='linenum'>  859</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> operation is currently being executed on the same key.
</span><span class='linenum'>  860</span> 
<span class='linenum'>  861</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">handle_commit_request</span><span class="meta meta_parens meta_parens_c">(<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>)</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  862</span> 
<span class='linenum'>  863</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">pending</span> agr</span>;
<span class='linenum'>  864</span>     <span class="storage storage_type storage_type_c">int</span> temp_addr = messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span>;
<span class='linenum'>  865</span> 
<span class='linenum'>  866</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The message to send back to the active server
</span><span class='linenum'>  867</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> is prepared
</span><span class='linenum'>  868</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span> = messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.to</span>;
<span class='linenum'>  869</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.to</span> = temp_addr;
<span class='linenum'>  870</span> 
<span class='linenum'>  871</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>==<span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) &amp;&amp; (!<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">find_operation</span>(</span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>))) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  872</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If no other operation is currently in progress on the same
</span><span class='linenum'>  873</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> key, the operation is pushed back into the local Pending
</span><span class='linenum'>  874</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> List
</span><span class='linenum'>  875</span>         agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span> = messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>;
<span class='linenum'>  876</span>         agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl</span> = messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl</span>;
<span class='linenum'>  877</span>         agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.resp</span> = messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>;
<span class='linenum'>  878</span>         agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.status</span> = <span class="constant constant_numeric constant_numeric_c">0</span>;
<span class='linenum'>  879</span>         agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.client_socket_fd</span> = -<span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  880</span>         agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pid_child</span> = -<span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  881</span>         agr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.optime</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">time</span>(<span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'>  882</span>     
<span class='linenum'>  883</span>         (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">push_back</span>(</span>agr);
<span class='linenum'>  884</span>     }</span>
<span class='linenum'>  885</span>     
<span class='linenum'>  886</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The response is sent back to the originating server
</span><span class='linenum'>  887</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> regardless to the fact that it could be a Commit or
</span><span class='linenum'>  888</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> an Abort.
</span><span class='linenum'>  889</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">    </span><span class="support support_function support_function_any-method support_function_any-method_c">contact_host</span>(</span>messg, <span class="constant constant_language constant_language_c">false</span>);
<span class='linenum'>  890</span> 
<span class='linenum'>  891</span> }</span></span>
<span class='linenum'>  892</span> 
<span class='linenum'>  893</span> 
<span class='linenum'>  894</span> 
<span class='linenum'>  895</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> void handle_commit_response(struct db_msg messg)
</span><span class='linenum'>  896</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  897</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function is called on the active side once a response to
</span><span class='linenum'>  898</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> a Commit Request is received. If any of the server answers with
</span><span class='linenum'>  899</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> an 'Abort', then the Global decision for that operation will
</span><span class='linenum'>  900</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> be a Global Abort.
</span><span class='linenum'>  901</span> 
<span class='linenum'>  902</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">handle_commit_response</span><span class="meta meta_parens meta_parens_c">(<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>)</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  903</span> 
<span class='linenum'>  904</span>     list&lt;pending&gt;::iterator it;
<span class='linenum'>  905</span>     
<span class='linenum'>  906</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Searching for the operation into the Pending List...
</span><span class='linenum'>  907</span>     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>it = (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  908</span>         
<span class='linenum'>  909</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>((*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>==messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>) &amp;&amp; ((*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span>==messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span>)) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  910</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the operation has been found...
</span><span class='linenum'>  911</span>         
<span class='linenum'>  912</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>==<span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>A<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  913</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If any of the server answers with an Abort, the
</span><span class='linenum'>  914</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Global Decision Variable is changed from the default
</span><span class='linenum'>  915</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> value (Commit) to an Abort.
</span><span class='linenum'>  916</span>                 (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.resp</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>A<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  917</span>             }</span>
<span class='linenum'>  918</span>             
<span class='linenum'>  919</span>             (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pend</span>--;
<span class='linenum'>  920</span>             cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>(*it).pend is <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pend</span> &lt;&lt; endl;
<span class='linenum'>  921</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  922</span>         }</span>
<span class='linenum'>  923</span>         
<span class='linenum'>  924</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">size</span>(</span>)==<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  925</span>         
<span class='linenum'>  926</span>     }</span>
<span class='linenum'>  927</span>     
<span class='linenum'>  928</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>((*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pend</span>)==<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  929</span>         
<span class='linenum'>  930</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If all the passive servers have replied to the Commit Request,
</span><span class='linenum'>  931</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> the global decision is written into the Pipe connecting the
</span><span class='linenum'>  932</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> main process to the child which is responsible for the operation
</span><span class='linenum'>  933</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">        </span><span class="support support_function support_function_any-method support_function_any-method_c">write</span>(</span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pipe</span>[<span class="constant constant_numeric constant_numeric_c">1</span>], &amp;(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.resp</span>, <span class="constant constant_numeric constant_numeric_c">1</span>);
<span class='linenum'>  934</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">        </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pipe</span>[<span class="constant constant_numeric constant_numeric_c">1</span>]);
<span class='linenum'>  935</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">        </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pipe</span>[<span class="constant constant_numeric constant_numeric_c">0</span>]);
<span class='linenum'>  936</span>         
<span class='linenum'>  937</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The Pending field is clean to become an ACK counter
</span><span class='linenum'>  938</span>         (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pend</span> = (*replicalist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">size</span>(</span>);
<span class='linenum'>  939</span>     }</span>
<span class='linenum'>  940</span> }</span></span>
<span class='linenum'>  941</span> 
<span class='linenum'>  942</span> 
<span class='linenum'>  943</span> 
<span class='linenum'>  944</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> void handle_global_recv(struct db_msg messg)
</span><span class='linenum'>  945</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  946</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function is called on the passive server side
</span><span class='linenum'>  947</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> everytime a Global Decision (Global Commit or Global
</span><span class='linenum'>  948</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Abort) is received from an active server.
</span><span class='linenum'>  949</span> 
<span class='linenum'>  950</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">handle_global_recv</span><span class="meta meta_parens meta_parens_c">(<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>)</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  951</span> 
<span class='linenum'>  952</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">couple</span> temp_record</span>;
<span class='linenum'>  953</span>     
<span class='linenum'>  954</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>K<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  955</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the received Decision is a Global Commit, the operation
</span><span class='linenum'>  956</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> is performed locally, and then the ACK is set as 'D'
</span><span class='linenum'>  957</span>         temp_record =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">perform_operation</span>(</span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl</span>);
<span class='linenum'>  958</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>temp_record<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.operation</span>==<span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  959</span>             messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>D<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  960</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  961</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If something goes wrong while performing the operation
</span><span class='linenum'>  962</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> locally, an Abort ACK is sent back to the active server
</span><span class='linenum'>  963</span>             cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>--- AAARGH! Distributed DB lost synchrony! A PASV server had<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  964</span>             cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>            an error while writing an operation on the stable storage!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  965</span>             messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>E<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  966</span>         }</span>
<span class='linenum'>  967</span>     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  968</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the received Decision is a Global Abort, the ACK
</span><span class='linenum'>  969</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> is set as 'D'
</span><span class='linenum'>  970</span>         messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>D<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  971</span>     }</span>
<span class='linenum'>  972</span> 
<span class='linenum'>  973</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The ACK is then sent back to the active server which sent the
</span><span class='linenum'>  974</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Global Decision
</span><span class='linenum'>  975</span> 
<span class='linenum'>  976</span>     <span class="storage storage_type storage_type_c">int</span> temp_addr = messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span>;
<span class='linenum'>  977</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span> = messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.to</span>;
<span class='linenum'>  978</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.to</span> = temp_addr;
<span class='linenum'>  979</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">    </span><span class="support support_function support_function_any-method support_function_any-method_c">contact_host</span>(</span>messg, <span class="constant constant_language constant_language_c">false</span>);
<span class='linenum'>  980</span>     
<span class='linenum'>  981</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The operation has been either performed or aborted, so no additional
</span><span class='linenum'>  982</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> work should be done on the passive side, then the operation is removed
</span><span class='linenum'>  983</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> from the local passive Pending List
</span><span class='linenum'>  984</span>     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;pending&gt;::iterator it = (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  985</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>((*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>==messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>) &amp;&amp; ((*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span>==messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span>) &amp;&amp; ((*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.status</span>==<span class="constant constant_numeric constant_numeric_c">0</span>)) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  986</span>             cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>- END of operation <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>: locally <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> &lt;&lt; endl;
<span class='linenum'>  987</span>             (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">erase</span>(</span>it);
<span class='linenum'>  988</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  989</span>         }</span>
<span class='linenum'>  990</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">size</span>(</span>)==<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  991</span>     }</span>
<span class='linenum'>  992</span> }</span></span>
<span class='linenum'>  993</span> 
<span class='linenum'>  994</span> 
<span class='linenum'>  995</span> 
<span class='linenum'>  996</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> void handle_ack(struct db_msg messg)
</span><span class='linenum'>  997</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  998</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function is called on the active server side everytime
</span><span class='linenum'>  999</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> an ACK from a passive server is received, related to the fact
</span><span class='linenum'> 1000</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> that the Global Decision has been received and the operation
</span><span class='linenum'> 1001</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> has been performed (in the case of Global Commit) or aborted (if
</span><span class='linenum'> 1002</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> the global decision was a Global Abort).
</span><span class='linenum'> 1003</span> 
<span class='linenum'> 1004</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">handle_ack</span><span class="meta meta_parens meta_parens_c">(<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>)</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1005</span> 
<span class='linenum'> 1006</span>     list&lt;pending&gt;::iterator it;
<span class='linenum'> 1007</span> 
<span class='linenum'> 1008</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> A remote passive server has ended its work, so the active server
</span><span class='linenum'> 1009</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> should wait for one less server to complete the work.
</span><span class='linenum'> 1010</span> 
<span class='linenum'> 1011</span>     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>it = (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1012</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>==messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span> &amp;&amp; ((*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span>==messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span>)) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1013</span>             (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pend</span>--;
<span class='linenum'> 1014</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'> 1015</span>         }</span>
<span class='linenum'> 1016</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">size</span>(</span>)==<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'> 1017</span>     }</span>
<span class='linenum'> 1018</span>     
<span class='linenum'> 1019</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the current ACK is the last acknowledgment (no more server
</span><span class='linenum'> 1020</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> have to respond), the response to send back to the client
</span><span class='linenum'> 1021</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> is prepared.
</span><span class='linenum'> 1022</span>     
<span class='linenum'> 1023</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>((*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pend</span>)==<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1024</span>         
<span class='linenum'> 1025</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.resp</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'> 1026</span>             messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>K<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'> 1027</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1028</span>             messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>N<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'> 1029</span>         }</span>
<span class='linenum'> 1030</span>         
<span class='linenum'> 1031</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Contacting the client...
</span><span class='linenum'> 1032</span>         messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl</span> = (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl</span>;
<span class='linenum'> 1033</span>         messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cs</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'> 1034</span>         messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span> = (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.client_socket_fd</span>;
<span class='linenum'> 1035</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">        </span><span class="support support_function support_function_any-method support_function_any-method_c">contact_host</span>(</span>messg,<span class="constant constant_language constant_language_c">false</span>);
<span class='linenum'> 1036</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">        </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span>);
<span class='linenum'> 1037</span>         
<span class='linenum'> 1038</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The 2PC is ended, and the operation is removed from the
</span><span class='linenum'> 1039</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> list of pending operations.
</span><span class='linenum'> 1040</span>         (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">erase</span>(</span>it);       
<span class='linenum'> 1041</span>     }</span>
<span class='linenum'> 1042</span> }</span></span>
<span class='linenum'> 1043</span> 
<span class='linenum'> 1044</span> 
<span class='linenum'> 1045</span> 
<span class='linenum'> 1046</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> void handle_server(struct db_msg messg)
</span><span class='linenum'> 1047</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'> 1048</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function is called everytime a server receives
</span><span class='linenum'> 1049</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> a packet from another server. Based on the content
</span><span class='linenum'> 1050</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> of the message, a specific handler is called.
</span><span class='linenum'> 1051</span> 
<span class='linenum'> 1052</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">handle_server</span><span class="meta meta_parens meta_parens_c">(<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'> 1053</span>     
<span class='linenum'> 1054</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>R<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'> 1055</span>         
<span class='linenum'> 1056</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The received message is a COMMIT REQUEST. Hence, a check about
</span><span class='linenum'> 1057</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> a possible ongoing operation on the same key is performed, 
</span><span class='linenum'> 1058</span>         <span class="keyword keyword_control keyword_control_c">if</span>(<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">find_active</span>(</span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span>,messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span>)) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1059</span>             cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! Another operation is taking place on this key!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'> 1060</span>             messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>A<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'> 1061</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1062</span>             messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'> 1063</span>         }</span>
<span class='linenum'> 1064</span>         
<span class='linenum'> 1065</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Handling the COMMIT REQUEST received from the active server
</span><span class='linenum'> 1066</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">        </span><span class="support support_function support_function_any-method support_function_any-method_c">handle_commit_request</span>(</span>messg);
<span class='linenum'> 1067</span>         
<span class='linenum'> 1068</span>     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1069</span>         
<span class='linenum'> 1070</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> || messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>A<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1071</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Handling the COMMIT RESPONSE (COMMIT or ABORT) received from another
</span><span class='linenum'> 1072</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> passive server
</span><span class='linenum'> 1073</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">            </span><span class="support support_function support_function_any-method support_function_any-method_c">handle_commit_response</span>(</span>messg);
<span class='linenum'> 1074</span>             
<span class='linenum'> 1075</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1076</span>             
<span class='linenum'> 1077</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>K<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> || messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>N<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1078</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Handling the GLOBAL DECISION (GLOBAL COMMIT or GLOBAL ABORT) received
</span><span class='linenum'> 1079</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> from the active server
</span><span class='linenum'> 1080</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                </span><span class="support support_function support_function_any-method support_function_any-method_c">handle_global_recv</span>(</span>messg);
<span class='linenum'> 1081</span>                 
<span class='linenum'> 1082</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1083</span>                 
<span class='linenum'> 1084</span>                 <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>D<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> || messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>E<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1085</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Handling the ACK (D is ACK to Global Commit, E is ACK to Global Abort)
</span><span class='linenum'> 1086</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> received from another passive server
</span><span class='linenum'> 1087</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">handle_ack</span>(</span>messg);
<span class='linenum'> 1088</span>                     
<span class='linenum'> 1089</span>                 }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1090</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error Handling
</span><span class='linenum'> 1091</span>                     cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! This server can't understand interserver response from another server!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;    
<span class='linenum'> 1092</span>                                     
<span class='linenum'> 1093</span>                 }</span>
<span class='linenum'> 1094</span>                 
<span class='linenum'> 1095</span>             }</span>
<span class='linenum'> 1096</span>             
<span class='linenum'> 1097</span>         }</span>
<span class='linenum'> 1098</span>         
<span class='linenum'> 1099</span>     }</span>   
<span class='linenum'> 1100</span>     
<span class='linenum'> 1101</span> }</span></span>
<span class='linenum'> 1102</span> 
<span class='linenum'> 1103</span> 
<span class='linenum'> 1104</span> 
<span class='linenum'> 1105</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> void wait_for_packet(int port)
</span><span class='linenum'> 1106</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'> 1107</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function waits for a new packet to arrive. The incoming packet
</span><span class='linenum'> 1108</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> could come from a client or another server. Based on the content
</span><span class='linenum'> 1109</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> on the packet (specifically, on the CMD field), the correct function
</span><span class='linenum'> 1110</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> (handle_server or handle_client) is called.
</span><span class='linenum'> 1111</span> 
<span class='linenum'> 1112</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">wait_for_packet</span><span class="meta meta_parens meta_parens_c">(<span class="storage storage_type storage_type_c">int</span> port)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'> 1113</span>     
<span class='linenum'> 1114</span>     <span class="support support_type support_type_sys-types support_type_sys-types_c">pid_t</span> pid;
<span class='linenum'> 1115</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">sockaddr_in</span> my_addr</span>;
<span class='linenum'> 1116</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>struct couple record;
</span><span class='linenum'> 1117</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>;
<span class='linenum'> 1118</span>     <span class="storage storage_type storage_type_c">int</span> sockfd;
<span class='linenum'> 1119</span>     
<span class='linenum'> 1120</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the socket server side
</span><span class='linenum'> 1121</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(sockfd =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">socket</span> (</span>AF_INET, SOCK_STREAM, IPPROTO_TCP)) &lt; <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1122</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'> 1123</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">1</span>);
<span class='linenum'> 1124</span>     }</span>
<span class='linenum'> 1125</span>     
<span class='linenum'> 1126</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Setting the server parameters
</span><span class='linenum'> 1127</span>     my_addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_family</span> = AF_INET;
<span class='linenum'> 1128</span>     my_addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_addr.s_addr</span> =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">htonl</span>(</span>INADDR_ANY);
<span class='linenum'> 1129</span>     my_addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_port</span> =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">htons</span>(</span>port);
<span class='linenum'> 1130</span> 
<span class='linenum'> 1131</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Binding the socket with server address
</span><span class='linenum'> 1132</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Starting server...<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'> 1133</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Binding...<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'> 1134</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">bind</span>(</span>sockfd, (<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">sockaddr</span> *</span>) &amp;my_addr,<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span>(</span>my_addr)) &lt; <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1135</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'> 1136</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">        </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>sockfd);
<span class='linenum'> 1137</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">2</span>);
<span class='linenum'> 1138</span>     }</span>
<span class='linenum'> 1139</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Server started!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'> 1140</span>     
<span class='linenum'> 1141</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The server is listening to incoming connections
</span><span class='linenum'> 1142</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">listen</span>(</span>sockfd, <span class="constant constant_numeric constant_numeric_c">10</span>) &lt; <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1143</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'> 1144</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">        </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>sockfd);
<span class='linenum'> 1145</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">3</span>);
<span class='linenum'> 1146</span>     }</span>
<span class='linenum'> 1147</span> 
<span class='linenum'> 1148</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Loop to serve all incoming connections
</span><span class='linenum'> 1149</span>     <span class="keyword keyword_control keyword_control_c">while</span>(<span class="constant constant_numeric constant_numeric_c">1</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1150</span>         
<span class='linenum'> 1151</span>         <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">sockaddr_in</span> addr</span>;
<span class='linenum'> 1152</span>         socklen_t len =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span>(</span>addr);
<span class='linenum'> 1153</span>         
<span class='linenum'> 1154</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The server accepts the connections
</span><span class='linenum'> 1155</span>         <span class="storage storage_type storage_type_c">int</span> conn_fd =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">accept</span>(</span>sockfd, (<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">sockaddr</span>*</span>) &amp;addr, &amp;len);
<span class='linenum'> 1156</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>conn_fd &lt; <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1157</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">            </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'> 1158</span>         }</span>
<span class='linenum'> 1159</span>         
<span class='linenum'> 1160</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The server receives the data from client
</span><span class='linenum'> 1161</span>         <span class="storage storage_type storage_type_c">int</span> host_len =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">recv</span>(</span>conn_fd, (<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span>*</span>) &amp;messg,<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span>(</span>db_msg),<span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'> 1162</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>host_len &lt; <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1163</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">            </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'> 1164</span>         }</span>
<span class='linenum'> 1165</span>         
<span class='linenum'> 1166</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Printing some informations on the screen... 
</span><span class='linenum'> 1167</span>         cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>&gt; PACKET! From IP <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt;<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">inet_ntoa</span>(</span>addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_addr</span>) &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> port <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt;<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">ntohs</span> (</span>addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_port</span>) &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>: <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> with <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.operation</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.value</span> &lt;&lt; endl;
<span class='linenum'> 1168</span>         
<span class='linenum'> 1169</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cs</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'> 1170</span>             
<span class='linenum'> 1171</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the packet is coming from the client...
</span><span class='linenum'> 1172</span>             messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span> = conn_fd;
<span class='linenum'> 1173</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">            </span><span class="support support_function support_function_any-method support_function_any-method_c">handle_client</span>(</span>messg);
<span class='linenum'> 1174</span>             
<span class='linenum'> 1175</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1176</span>             
<span class='linenum'> 1177</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cs</span> == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>S<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'> 1178</span>                 
<span class='linenum'> 1179</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the packet is coming from another server...
</span><span class='linenum'> 1180</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                </span><span class="support support_function support_function_any-method support_function_any-method_c">handle_server</span>(</span>messg);
<span class='linenum'> 1181</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>conn_fd);
<span class='linenum'> 1182</span>                 
<span class='linenum'> 1183</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1184</span>                 
<span class='linenum'> 1185</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Closing socket
</span><span class='linenum'> 1186</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>conn_fd);
<span class='linenum'> 1187</span>                 cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! This server can't understand the received MSG!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'> 1188</span>                 
<span class='linenum'> 1189</span>             }</span>
<span class='linenum'> 1190</span>         }</span>   
<span class='linenum'> 1191</span>     }</span>
<span class='linenum'> 1192</span> }</span></span>
<span class='linenum'> 1193</span> 
<span class='linenum'> 1194</span> 
<span class='linenum'> 1195</span> 
<span class='linenum'> 1196</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> void handle_alarm (int signum)
</span><span class='linenum'> 1197</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'> 1198</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function is called every time an alarm is generated. This
</span><span class='linenum'> 1199</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> happens every lifetime_row for all the servers, to remove
</span><span class='linenum'> 1200</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> dead undone operations and to notify the client with an
</span><span class='linenum'> 1201</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> abort.
</span><span class='linenum'> 1202</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Timeout values are defined as constant at the beginning
</span><span class='linenum'> 1203</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> of this file (lifetime_row).
</span><span class='linenum'> 1204</span> 
<span class='linenum'> 1205</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">handle_alarm</span> <span class="meta meta_parens meta_parens_c">(<span class="storage storage_type storage_type_c">int</span> signum)</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1206</span> 
<span class='linenum'> 1207</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>;
<span class='linenum'> 1208</span>     
<span class='linenum'> 1209</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>-&gt; Check for undone operations in timeout...<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'> 1210</span>     
<span class='linenum'> 1211</span>     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;pending&gt;::iterator it = (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1212</span>         
<span class='linenum'> 1213</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Actual time
</span><span class='linenum'> 1214</span>         <span class="support support_type support_type_sys-types support_type_sys-types_c">time_t</span> now =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">time</span>(<span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'> 1215</span>         
<span class='linenum'> 1216</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If the current row is in timeout...
</span><span class='linenum'> 1217</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(now &gt;= (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.optime</span>+lifetime_row)) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1218</span>             
<span class='linenum'> 1219</span>             cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>   -&gt; Operation timeout! Removing <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.operation</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; endl;
<span class='linenum'> 1220</span>             
<span class='linenum'> 1221</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> If this is the active server for the operation the client is informed...
</span><span class='linenum'> 1222</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.status</span>==<span class="constant constant_numeric constant_numeric_c">1</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1223</span>                                     
<span class='linenum'> 1224</span>                 cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>   -&gt; Notifying client about removal of <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.operation</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; endl;
<span class='linenum'> 1225</span>                 
<span class='linenum'> 1226</span>                 messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl</span> = (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl</span>;
<span class='linenum'> 1227</span>                 messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span> = (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.client_socket_fd</span>;
<span class='linenum'> 1228</span>                 messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cs</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'> 1229</span>                 messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>N<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'> 1230</span>                 
<span class='linenum'> 1231</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Notifying the client about the removal...
</span><span class='linenum'> 1232</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                </span><span class="support support_function support_function_any-method support_function_any-method_c">contact_host</span>(</span>messg,<span class="constant constant_language constant_language_c">false</span>);              
<span class='linenum'> 1233</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.from</span>);
<span class='linenum'> 1234</span>                 
<span class='linenum'> 1235</span>                 cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>   -&gt; Terminating the child for <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.operation</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; (*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; endl;
<span class='linenum'> 1236</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                </span><span class="support support_function support_function_any-method support_function_any-method_c">kill</span>(</span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.pid_child</span>,SIGKILL);
<span class='linenum'> 1237</span>                 
<span class='linenum'> 1238</span>             }</span>
<span class='linenum'> 1239</span>             
<span class='linenum'> 1240</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Purging the operation from the list
</span><span class='linenum'> 1241</span>             (*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">erase</span>(</span>it);
<span class='linenum'> 1242</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*pendinglist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">size</span>(</span>)== <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1243</span>                 <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'> 1244</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1245</span>                 it--;
<span class='linenum'> 1246</span>             }</span>
<span class='linenum'> 1247</span>             
<span class='linenum'> 1248</span>             cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>   -&gt; Removal of dead operation done!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;                
<span class='linenum'> 1249</span>         }</span>
<span class='linenum'> 1250</span>     }</span>
<span class='linenum'> 1251</span> }</span></span>
<span class='linenum'> 1252</span> 
<span class='linenum'> 1253</span> 
<span class='linenum'> 1254</span> 
<span class='linenum'> 1255</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> char *getifaddr (char *ifname)
</span><span class='linenum'> 1256</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'> 1257</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function reads a single network interface IP from the
</span><span class='linenum'> 1258</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Operating System, and gives that as an output string.
</span><span class='linenum'> 1259</span> 
<span class='linenum'> 1260</span> <span class="storage storage_type storage_type_c">char</span> *<span class="meta meta_function meta_function_c"><span class="entity entity_name entity_name_function entity_name_function_c">getifaddr</span> <span class="meta meta_parens meta_parens_c">(<span class="storage storage_type storage_type_c">char</span> *ifname)</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1261</span>     <span class="storage storage_type storage_type_c">int</span> fd;
<span class='linenum'> 1262</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">ifreq</span> ifr</span>;
<span class='linenum'> 1263</span>     <span class="storage storage_type storage_type_c">char</span> *addr = <span class="constant constant_language constant_language_c">NULL</span>;
<span class='linenum'> 1264</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">sockaddr_in</span> *sin </span>= (<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">sockaddr_in</span> *</span>) &amp;ifr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ifr_ifru.ifru_addr</span>;
<span class='linenum'> 1265</span> 
<span class='linenum'> 1266</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(fd =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">socket</span>(</span>AF_INET, SOCK_STREAM, <span class="constant constant_numeric constant_numeric_c">0</span>)) == -<span class="constant constant_numeric constant_numeric_c">1</span>)
<span class='linenum'> 1267</span>         <span class="keyword keyword_control keyword_control_c">return</span> <span class="constant constant_language constant_language_c">NULL</span>;
<span class='linenum'> 1268</span> 
<span class='linenum'> 1269</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">    </span><span class="support support_function support_function_C99 support_function_C99_c">memset</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>&amp;ifr, <span class="constant constant_numeric constant_numeric_c">0</span>,<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span> (</span>ifr));
<span class='linenum'> 1270</span> 
<span class='linenum'> 1271</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">    </span><span class="support support_function support_function_C99 support_function_C99_c">strcpy</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>ifr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ifr_name</span>, ifname);
<span class='linenum'> 1272</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">    </span><span class="support support_function support_function_C99 support_function_C99_c">sin</span>-&gt;sin_family = AF_INET;
<span class='linenum'> 1273</span> 
<span class='linenum'> 1274</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">ioctl</span> (</span>fd, SIOCGIFADDR, &amp;ifr) == <span class="constant constant_numeric constant_numeric_c">0</span>)
<span class='linenum'> 1275</span>         addr =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">inet_ntoa</span> (</span><span class="support support_function support_function_C99 support_function_C99_c">sin</span>-&gt;sin_addr);
<span class='linenum'> 1276</span> 
<span class='linenum'> 1277</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">    </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span> (</span>fd);
<span class='linenum'> 1278</span> 
<span class='linenum'> 1279</span>     <span class="keyword keyword_control keyword_control_c">return</span> addr;
<span class='linenum'> 1280</span> }</span></span>
<span class='linenum'> 1281</span> 
<span class='linenum'> 1282</span> 
<span class='linenum'> 1283</span> 
<span class='linenum'> 1284</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> list&lt;string&gt; create_list_interface()
</span><span class='linenum'> 1285</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'> 1286</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function creates the list of network interfaces
</span><span class='linenum'> 1287</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> based on data read from getifaddr function.
</span><span class='linenum'> 1288</span> 
<span class='linenum'> 1289</span> list&lt;string&gt;<span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">create_list_interface</span><span class="meta meta_parens meta_parens_c">()</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1290</span>     
<span class='linenum'> 1291</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">if_nameindex</span> *ifni</span>;
<span class='linenum'> 1292</span>     list&lt;string&gt; iplist;
<span class='linenum'> 1293</span>     <span class="storage storage_type storage_type_c">char</span>* ip;
<span class='linenum'> 1294</span>     
<span class='linenum'> 1295</span>     ifni =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">if_nameindex</span>(</span>);
<span class='linenum'> 1296</span>     
<span class='linenum'> 1297</span>     <span class="keyword keyword_control keyword_control_c">while</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>ifni-&gt;if_name != <span class="constant constant_language constant_language_c">NULL</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1298</span>         
<span class='linenum'> 1299</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> For every interface...
</span><span class='linenum'> 1300</span>         ip =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">getifaddr</span> (</span>ifni-&gt;if_name);
<span class='linenum'> 1301</span> 
<span class='linenum'> 1302</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>ip != <span class="constant constant_language constant_language_c">NULL</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1303</span>             iplist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">push_back</span>(</span>ip);
<span class='linenum'> 1304</span>         }</span>
<span class='linenum'> 1305</span>         
<span class='linenum'> 1306</span>         ifni++;
<span class='linenum'> 1307</span>     }</span>
<span class='linenum'> 1308</span>     
<span class='linenum'> 1309</span>     <span class="keyword keyword_control keyword_control_c">return</span> iplist;
<span class='linenum'> 1310</span>     
<span class='linenum'> 1311</span> }</span></span>
<span class='linenum'> 1312</span> 
<span class='linenum'> 1313</span> 
<span class='linenum'> 1314</span> 
<span class='linenum'> 1315</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> main()
</span><span class='linenum'> 1316</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'> 1317</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The main body
</span><span class='linenum'> 1318</span> 
<span class='linenum'> 1319</span> <span class="storage storage_type storage_type_c">int</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">main</span><span class="meta meta_parens meta_parens_c">()</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1320</span>     
<span class='linenum'> 1321</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the timer to destroy appended operations
</span><span class='linenum'> 1322</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">itimerval</span> timer</span>;
<span class='linenum'> 1323</span>     list&lt;string&gt; iplist;
<span class='linenum'> 1324</span>     <span class="storage storage_type storage_type_c">int</span> port;
<span class='linenum'> 1325</span> 
<span class='linenum'> 1326</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> To close all children and avoid zombies
</span><span class='linenum'> 1327</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">    </span><span class="support support_function support_function_C99 support_function_C99_c">signal</span>(SIGCHLD, SIG_IGN);
<span class='linenum'> 1328</span> 
<span class='linenum'> 1329</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Signal to handle all processes blocked because an
</span><span class='linenum'> 1330</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> active server is blocked
</span><span class='linenum'> 1331</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">    </span><span class="support support_function support_function_C99 support_function_C99_c">signal</span>(SIGALRM, handle_alarm);
<span class='linenum'> 1332</span>     
<span class='linenum'> 1333</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Parameters of the timer, to look in the pending operation list
</span><span class='linenum'> 1334</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> and decide whether or not some operation is in timeout
</span><span class='linenum'> 1335</span>     timer<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.it_value.tv_usec</span> = <span class="constant constant_numeric constant_numeric_c">0</span>;
<span class='linenum'> 1336</span>     timer<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.it_value.tv_sec</span> = timeout;
<span class='linenum'> 1337</span>     timer<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.it_interval.tv_usec</span> = <span class="constant constant_numeric constant_numeric_c">0</span>; 
<span class='linenum'> 1338</span>     timer<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.it_interval.tv_sec</span> = timeout;
<span class='linenum'> 1339</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">    </span><span class="support support_function support_function_any-method support_function_any-method_c">setitimer</span>(</span>ITIMER_REAL, &amp;timer, <span class="constant constant_language constant_language_c">NULL</span>);
<span class='linenum'> 1340</span>     
<span class='linenum'> 1341</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Initialization of random number generator (later used to assing random
</span><span class='linenum'> 1342</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> identifier to every operation)
</span><span class='linenum'> 1343</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">    </span><span class="support support_function support_function_C99 support_function_C99_c">srand</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="support support_function support_function_C99 support_function_C99_c">time</span>(<span class="constant constant_numeric constant_numeric_c">0</span>));
<span class='linenum'> 1344</span>     
<span class='linenum'> 1345</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creation of network interfaces list of the server machine
</span><span class='linenum'> 1346</span>     iplist =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">create_list_interface</span>(</span>);
<span class='linenum'> 1347</span>     
<span class='linenum'> 1348</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the list of servers and filling it
</span><span class='linenum'> 1349</span>     port =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">read_file</span>(</span>iplist);
<span class='linenum'> 1350</span>     
<span class='linenum'> 1351</span>     <span class="keyword keyword_control keyword_control_c">if</span>(port==-<span class="constant constant_numeric constant_numeric_c">1</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'> 1352</span>         cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! In file serverlist.txt there are not the IP address and port for this machine<span class="constant constant_character constant_character_escape constant_character_escape_c">\n</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>;
<span class='linenum'> 1353</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'> 1354</span>     }</span> 
<span class='linenum'> 1355</span>     
<span class='linenum'> 1356</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Sorting the list of servers by their ID
</span><span class='linenum'> 1357</span>     (*replicalist).<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">sort</span>(</span>compare_repid);
<span class='linenum'> 1358</span> 
<span class='linenum'> 1359</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Going into wait mode for a new packet to arrive
</span><span class='linenum'> 1360</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">    </span><span class="support support_function support_function_any-method support_function_any-method_c">wait_for_packet</span>(</span>port);
<span class='linenum'> 1361</span>     
<span class='linenum'> 1362</span> }</span></span>
</span><span class='linenum'> 1363</span> </pre>
</body>
</html>