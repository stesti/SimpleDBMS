<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>client.cpp</title>
	<style type="text/css">
/* Stylesheet generated from TextMate theme
 *
 * Mac Classic
 * 
 *
 */

/* Mostly to improve view within the TextMate HTML viewer */
body {
	margin: 0;
	padding: 0;
}

pre.textmate-source {
	margin: 0;
	padding: 0 0 0 2px;
	font-family: Monaco, monospace;
	font-size: 11px;
	line-height: 1.3em;
	word-wrap: break-word;
	white-space: pre;
	white-space: pre-wrap;
	white-space: -moz-pre-wrap;
	white-space: -o-pre-wrap;
}

pre.textmate-source.mac_classic {
	color: #000000;
	background-color: #FFFFFF;
}

pre.textmate-source .linenum {
	width: 75px;
	padding: 0.1em 1em 0.2em 0;
	color: #888;
	background-color: #eee;
}
pre.textmate-source.mac_classic span {
   padding-top: 0.2em;
   padding-bottom: 0.1em;
}
pre.textmate-source.mac_classic ::selection {
	background-color: rgba(77, 151, 255, 0.33);
}
/* Comment */
pre.textmate-source.mac_classic .comment {
	color: #0066FF;
	font-style: italic;
}

/* Keyword */
pre.textmate-source.mac_classic .keyword, pre.textmate-source.mac_classic .storage {
	color: #0000FF;
	font-weight: bold;
}

/* Number */
pre.textmate-source.mac_classic .constant_numeric {
	color: #0000CD;
}

/* User-defined constant */
pre.textmate-source.mac_classic .constant {
	color: #C5060B;
	font-weight: bold;
}

/* Built-in constant */
pre.textmate-source.mac_classic .constant_language {
	color: #585CF6;
	font-weight: bold;
}

/* Variable */
pre.textmate-source.mac_classic .variable_language, pre.textmate-source.mac_classic .variable_other {
	color: #318495;
}

/* String */
pre.textmate-source.mac_classic .string {
	color: #036A07;
}

/* String interpolation */
pre.textmate-source.mac_classic .constant_character_escape, pre.textmate-source.mac_classic .string .source {
	color: #26B31A;
}

/* Preprocessor line */
pre.textmate-source.mac_classic .meta_preprocessor {
	color: #1A921C;
}

/* Preprocessor directive */
pre.textmate-source.mac_classic .keyword_control_import {
	color: #0C450D;
	font-weight: bold;
}

/* Function name */
pre.textmate-source.mac_classic .entity_name_function, pre.textmate-source.mac_classic .support_function_any-method {
	color: #0000A2;
	font-weight: bold;
}

/* Type name */
pre.textmate-source.mac_classic .entity_name_type {
	text-decoration: underline;
}

/* Inherited class name */
pre.textmate-source.mac_classic .entity_other_inherited-class {
	font-style: italic;
}

/* Function parameter */
pre.textmate-source.mac_classic .variable_parameter {
	font-style: italic;
}

/* Function argument and result types */
pre.textmate-source.mac_classic .storage_type_method {
	color: #70727E;
}

/* Section */
pre.textmate-source.mac_classic .meta_section .entity_name_section, pre.textmate-source.mac_classic .declaration_section .entity_name_section {
	font-style: italic;
}

/* Library function */
pre.textmate-source.mac_classic .support_function {
	color: #3C4C72;
	font-weight: bold;
}

/* Library object */
pre.textmate-source.mac_classic .support_class, pre.textmate-source.mac_classic .support_type {
	color: #6D79DE;
	font-weight: bold;
}

/* Library constant */
pre.textmate-source.mac_classic .support_constant {
	color: #06960E;
	font-weight: bold;
}

/* Library variable */
pre.textmate-source.mac_classic .support_variable {
	color: #21439C;
	font-weight: bold;
}

/* JS: Operator */
pre.textmate-source.mac_classic .keyword_operator_js {
	color: #687687;
}

/* Invalid */
pre.textmate-source.mac_classic .invalid {
	color: #FFFFFF;
	background-color: #990000;
}

/* Invalid trailing whitespace */
pre.textmate-source.mac_classic .invalid_deprecated_trailing-whitespace {
	background-color: #FFD0D0;
}

/* Embedded source */
pre.textmate-source.mac_classic .text .source, pre.textmate-source.mac_classic .string_unquoted {
	background-color: rgba(0, 0, 0, 0.05);
}

/* Embedded embedded source */
pre.textmate-source.mac_classic .text .source .string_unquoted, pre.textmate-source.mac_classic .text .source .text .source {
	background-color: rgba(0, 0, 0, 0.06);
}

/* Markup XML declaration */
pre.textmate-source.mac_classic .meta_tag_preprocessor_xml {
	color: #68685B;
}

/* Markup DOCTYPE */
pre.textmate-source.mac_classic .meta_tag_sgml_doctype, pre.textmate-source.mac_classic .meta_tag_sgml_doctype .entity, pre.textmate-source.mac_classic .meta_tag_sgml_doctype .string, pre.textmate-source.mac_classic .meta_tag_preprocessor_xml, pre.textmate-source.mac_classic .meta_tag_preprocessor_xml .entity, pre.textmate-source.mac_classic .meta_tag_preprocessor_xml .string {
	color: #888888;
}

/* Markup DTD */
pre.textmate-source.mac_classic .string_quoted_docinfo_doctype_DTD {
	font-style: italic;
}

/* Markup tag */
pre.textmate-source.mac_classic .meta_tag, pre.textmate-source.mac_classic .declaration_tag {
	color: #1C02FF;
}

/* Markup name of tag */
pre.textmate-source.mac_classic .entity_name_tag {
	font-weight: bold;
}

/* Markup tag attribute */
pre.textmate-source.mac_classic .entity_other_attribute-name {
	font-style: italic;
}

/* Markup: Heading */
pre.textmate-source.mac_classic .markup_heading {
	color: #0C07FF;
	font-weight: bold;
}

/* Markup: Quote */
pre.textmate-source.mac_classic .markup_quote {
	color: #000000;
	font-style: italic;
}

/* Markup: List */
pre.textmate-source.mac_classic .markup_list {
	color: #B90690;
}



	</style>
</head>

<body><pre class="textmate-source mac_classic"><span class='linenum'>    1</span> <span class="source source_c++"><span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>    2</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  ==========================================
</span><span class='linenum'>    3</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  ||  Simple DBMS System - Client         ||
</span><span class='linenum'>    4</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  ==========================================
</span><span class='linenum'>    5</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>    6</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  Coded in 2009 by
</span><span class='linenum'>    7</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  Davide.Perina@studenti.unitn.it
</span><span class='linenum'>    8</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  Stefano.Testi@studenti.unitn.it
</span><span class='linenum'>    9</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>   10</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  This work is released under the Creative Commons License
</span><span class='linenum'>   11</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>  Attribution-Noncommercial-Share Alike 3.0
</span><span class='linenum'>   12</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>   13</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>   14</span> 
<span class='linenum'>   15</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>sys/socket.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   16</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>netinet/in.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   17</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>sys/types.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   18</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>stdio.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   19</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>netdb.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   20</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>string.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   21</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>unistd.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   22</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>stdlib.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   23</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>iostream<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   24</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>fstream<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   25</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>arpa/inet.h<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   26</span> <span class="meta meta_preprocessor meta_preprocessor_c meta_preprocessor_c_include">#<span class="keyword keyword_control keyword_control_import keyword_control_import_include keyword_control_import_include_c">include</span> <span class="string string_quoted string_quoted_other string_quoted_other_lt-gt string_quoted_other_lt-gt_include string_quoted_other_lt-gt_include_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">&lt;</span>list<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">&gt;</span></span></span>
<span class='linenum'>   27</span> 
<span class='linenum'>   28</span> <span class="keyword keyword_control keyword_control_c++">using</span> <span class="meta meta_namespace-block meta_namespace-block_c++"><span class="storage storage_type storage_type_c++">namespace</span> <span class="entity entity_name entity_name_type entity_name_type_c++">std</span></span>;
<span class='linenum'>   29</span> 
<span class='linenum'>   30</span> 
<span class='linenum'>   31</span> 
<span class='linenum'>   32</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> DATA TYPES
</span><span class='linenum'>   33</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>   34</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Declaring data types:
</span><span class='linenum'>   35</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>     - replica
</span><span class='linenum'>   36</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           This data type is used to represent the coordinates to access
</span><span class='linenum'>   37</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           one of the replicated DB servers. It contains an integer identifier
</span><span class='linenum'>   38</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           for the replica, the IP address and the port.
</span><span class='linenum'>   39</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>     - couple
</span><span class='linenum'>   40</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           This data type is used to represent the specific operation to perform on
</span><span class='linenum'>   41</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           one of the servers.
</span><span class='linenum'>   42</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>     - db_msg
</span><span class='linenum'>   43</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           This is the message exchanged between the client and the servers,
</span><span class='linenum'>   44</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>           and between the servers.
</span><span class='linenum'>   45</span> 
<span class='linenum'>   46</span> 
<span class='linenum'>   47</span> <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">replica</span> <span class="punctuation punctuation_definition punctuation_definition_scope punctuation_definition_scope_c++">{</span>
<span class='linenum'>   48</span>     <span class="storage storage_type storage_type_c">int</span> id;                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Server ID
</span><span class='linenum'>   49</span>     <span class="storage storage_type storage_type_c">char</span> ip[<span class="constant constant_numeric constant_numeric_c">15</span>];                <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Server IP
</span><span class='linenum'>   50</span>     <span class="storage storage_type storage_type_c">int</span> port;                   <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Server Port
</span><span class='linenum'>   51</span> <span class="punctuation punctuation_definition punctuation_definition_invalid punctuation_definition_invalid_c++">}</span></span>;
<span class='linenum'>   52</span> 
<span class='linenum'>   53</span> 
<span class='linenum'>   54</span> <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">couple</span> <span class="punctuation punctuation_definition punctuation_definition_scope punctuation_definition_scope_c++">{</span>
<span class='linenum'>   55</span>     <span class="storage storage_type storage_type_c">char</span> operation;             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Operation: Q, D or I
</span><span class='linenum'>   56</span>     <span class="storage storage_type storage_type_c">int</span> key;                    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Key
</span><span class='linenum'>   57</span>     <span class="storage storage_type storage_type_c">int</span> value;                  <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Value
</span><span class='linenum'>   58</span> <span class="punctuation punctuation_definition punctuation_definition_invalid punctuation_definition_invalid_c++">}</span></span>;
<span class='linenum'>   59</span> 
<span class='linenum'>   60</span> <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> <span class="punctuation punctuation_definition punctuation_definition_scope punctuation_definition_scope_c++">{</span>
<span class='linenum'>   61</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">couple</span> cpl</span>;          <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Operation to perform and parameters
</span><span class='linenum'>   62</span>     <span class="storage storage_type storage_type_c">char</span> cs;                    <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Message involving a client (C) or inter-server (S)
</span><span class='linenum'>   63</span>     <span class="storage storage_type storage_type_c">char</span> cmd;                   <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Command: Commit (R)equest, (C)ommit Response, (A)bort, ...
</span><span class='linenum'>   64</span>     <span class="storage storage_type storage_type_c">int</span> opid;                   <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Operation identifier. On the Client-&gt;Server message it is -1
</span><span class='linenum'>   65</span>     <span class="storage storage_type storage_type_c">int</span> from;                   <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Msg coming from the server 'from'
</span><span class='linenum'>   66</span>     <span class="storage storage_type storage_type_c">int</span> to;                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Msg for the server 'to'
</span><span class='linenum'>   67</span> <span class="punctuation punctuation_definition punctuation_definition_invalid punctuation_definition_invalid_c++">}</span></span>;
<span class='linenum'>   68</span> 
<span class='linenum'>   69</span> 
<span class='linenum'>   70</span> 
<span class='linenum'>   71</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> FUNCTIONS
</span><span class='linenum'>   72</span> 
<span class='linenum'>   73</span> 
<span class='linenum'>   74</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> print_error()
</span><span class='linenum'>   75</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>   76</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function prints on the screen the list of parameters to use
</span><span class='linenum'>   77</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> when this program is executed
</span><span class='linenum'>   78</span> 
<span class='linenum'>   79</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">print_error</span><span class="meta meta_parens meta_parens_c">()</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>   80</span>     
<span class='linenum'>   81</span>     cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span><span class="constant constant_character constant_character_escape constant_character_escape_c">\n</span>ERROR! You should specify the operation to perform on the DB!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>   82</span>     cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>You should use either: <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>   83</span>     cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Q k s   -&gt; to perform a Query operation on the item associated to key k using server s, with k and s integer<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>   84</span>     cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>D k   -&gt; to perform a Delete operation on the item associated to key k, with k integer<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>   85</span>     cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>I k v -&gt; to perform an Insert operation with key k and value V, with k and v integers<span class="constant constant_character constant_character_escape constant_character_escape_c">\n</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>   86</span>     
<span class='linenum'>   87</span> }</span></span>
<span class='linenum'>   88</span> 
<span class='linenum'>   89</span> 
<span class='linenum'>   90</span> 
<span class='linenum'>   91</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> list&lt;replica&gt; format_line(string FileLineID, string FileLineIP, string FileLinePort, list&lt;replica&gt; replicalist)
</span><span class='linenum'>   92</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>   93</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The format_line function takes as input some parameters related to
</span><span class='linenum'>   94</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> a single db servers read from a single line of the servers file, and
</span><span class='linenum'>   95</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> appends them into the list of servers.
</span><span class='linenum'>   96</span> 
<span class='linenum'>   97</span> list&lt;replica&gt;<span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">format_line</span><span class="meta meta_parens meta_parens_c">(string FileLineID, string FileLineIP, string FileLinePort, list&lt;replica&gt; replicalist)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>   98</span>     
<span class='linenum'>   99</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating a temporary replica and filling it
</span><span class='linenum'>  100</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">replica</span> replica_temp</span>;
<span class='linenum'>  101</span>     replica_temp<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLineID.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  102</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">    </span><span class="support support_function support_function_C99 support_function_C99_c">strcpy</span>(replica_temp<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ip</span>,FileLineIP.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  103</span>     replica_temp<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.port</span> =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(FileLinePort.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">c_str</span>(</span>));
<span class='linenum'>  104</span>     
<span class='linenum'>  105</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Appending the new server to the list of db servers
</span><span class='linenum'>  106</span>     replicalist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">push_back</span>(</span>replica_temp);
<span class='linenum'>  107</span>     
<span class='linenum'>  108</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Returning the new list of servers
</span><span class='linenum'>  109</span>     <span class="keyword keyword_control keyword_control_c">return</span> replicalist;
<span class='linenum'>  110</span> 
<span class='linenum'>  111</span> }</span></span>
<span class='linenum'>  112</span> 
<span class='linenum'>  113</span> 
<span class='linenum'>  114</span> 
<span class='linenum'>  115</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> list&lt;replica&gt; read_file(list&lt;replica&gt; replicalist)
</span><span class='linenum'>  116</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  117</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The read_file function reads the file containing the list of the
</span><span class='linenum'>  118</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> db servers, and, line by line, passes these parameters to the
</span><span class='linenum'>  119</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> format_line function, to append them into the list of servers.
</span><span class='linenum'>  120</span> 
<span class='linenum'>  121</span> list&lt;replica&gt;<span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">read_file</span><span class="meta meta_parens meta_parens_c">(list&lt;replica&gt; replicalist)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  122</span> 
<span class='linenum'>  123</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Opening server list file
</span><span class='linenum'>  124</span>     ifstream<span class="meta meta_initialization meta_initialization_c"> <span class="variable variable_other variable_other_c">file</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>serverlist.txt<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  125</span> 
<span class='linenum'>  126</span>     string FileLineID;
<span class='linenum'>  127</span>     string FileLineIP;
<span class='linenum'>  128</span>     string FileLinePort;
<span class='linenum'>  129</span>     
<span class='linenum'>  130</span>     <span class="keyword keyword_control keyword_control_c">while</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>file) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  131</span>     
<span class='linenum'>  132</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Withdrawing server parameters from a single line of the servers file
</span><span class='linenum'>  133</span>         file &gt;&gt; FileLineID &gt;&gt; FileLineIP &gt;&gt; FileLinePort;
<span class='linenum'>  134</span>         
<span class='linenum'>  135</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span> !file ) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  136</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span> !file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">eof</span>(</span>) ) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  137</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  138</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error! Stream failure!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  139</span>             }</span>
<span class='linenum'>  140</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  141</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Passing the single line to the format_line function
</span><span class='linenum'>  142</span>             replicalist =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">format_line</span>(</span> FileLineID, FileLineIP, FileLinePort, replicalist);
<span class='linenum'>  143</span>         }</span>
<span class='linenum'>  144</span>         
<span class='linenum'>  145</span>     }</span>
<span class='linenum'>  146</span> 
<span class='linenum'>  147</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Closing server list file
</span><span class='linenum'>  148</span>     file.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>);
<span class='linenum'>  149</span> 
<span class='linenum'>  150</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Returning the list of servers filled with the data from the servers file
</span><span class='linenum'>  151</span>     <span class="keyword keyword_control keyword_control_c">return</span> replicalist;
<span class='linenum'>  152</span> 
<span class='linenum'>  153</span> }</span></span>
<span class='linenum'>  154</span> 
<span class='linenum'>  155</span> 
<span class='linenum'>  156</span> 
<span class='linenum'>  157</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> compare_repid(replica pos1, replica pos2)
</span><span class='linenum'>  158</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  159</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Compare function, to sort the list of servers by the ID server
</span><span class='linenum'>  160</span> 
<span class='linenum'>  161</span> <span class="storage storage_type storage_type_c">bool</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">compare_repid</span><span class="meta meta_parens meta_parens_c">(replica r1, replica r2)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  162</span>     <span class="keyword keyword_control keyword_control_c">if</span>(r1<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt; r2<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> )<span class="meta meta_block meta_block_c">{
<span class='linenum'>  163</span>         <span class="keyword keyword_control keyword_control_c">return</span> <span class="constant constant_language constant_language_c">true</span>;
<span class='linenum'>  164</span>     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  165</span>         <span class="keyword keyword_control keyword_control_c">return</span> <span class="constant constant_language constant_language_c">false</span>;
<span class='linenum'>  166</span>     }</span>
<span class='linenum'>  167</span>      
<span class='linenum'>  168</span> }</span></span>
<span class='linenum'>  169</span> 
<span class='linenum'>  170</span> 
<span class='linenum'>  171</span> 
<span class='linenum'>  172</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> perform_operation(char ip[], int port, char operation, int key, int value)
</span><span class='linenum'>  173</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  174</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The perform_operation connects to a specific server, sends the operation
</span><span class='linenum'>  175</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> (cointained in the couple struct) and waits for the response (another couple
</span><span class='linenum'>  176</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> struct) from the db server.
</span><span class='linenum'>  177</span> 
<span class='linenum'>  178</span> <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">perform_operation</span><span class="meta meta_parens meta_parens_c">(<span class="storage storage_type storage_type_c">char</span> ip[], <span class="storage storage_type storage_type_c">int</span> port, <span class="storage storage_type storage_type_c">char</span> operation, <span class="storage storage_type storage_type_c">int</span> key, <span class="storage storage_type storage_type_c">int</span> value, <span class="storage storage_type storage_type_c">int</span> srv)</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  179</span> 
<span class='linenum'>  180</span>     <span class="storage storage_type storage_type_c">int</span> sockfd;
<span class='linenum'>  181</span>     
<span class='linenum'>  182</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the message to send to the server and to
</span><span class='linenum'>  183</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> fill with the response from the server
</span><span class='linenum'>  184</span> 
<span class='linenum'>  185</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg</span>;
<span class='linenum'>  186</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.operation</span> = operation;
<span class='linenum'>  187</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> = key;
<span class='linenum'>  188</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.value</span> = value;
<span class='linenum'>  189</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.to</span> = srv;
<span class='linenum'>  190</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cs</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>C<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  191</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.opid</span> = -<span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  192</span>     messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span> = <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>Z<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>;
<span class='linenum'>  193</span> 
<span class='linenum'>  194</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Setting the connection parameters
</span><span class='linenum'>  195</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">sockaddr_in</span> server_addr</span>; 
<span class='linenum'>  196</span>     server_addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_family</span> = AF_INET;
<span class='linenum'>  197</span>     server_addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_addr.s_addr</span> =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">inet_addr</span>(</span>ip);
<span class='linenum'>  198</span>     server_addr<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.sin_port</span> =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">htons</span>(</span>port);
<span class='linenum'>  199</span>     
<span class='linenum'>  200</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the socket
</span><span class='linenum'>  201</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(sockfd =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">socket</span>(</span>AF_INET, SOCK_STREAM, IPPROTO_TCP))&lt;<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  202</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  203</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  204</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">2</span>);
<span class='linenum'>  205</span>     }</span>
<span class='linenum'>  206</span> 
<span class='linenum'>  207</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Trying to connect to the server
</span><span class='linenum'>  208</span>     <span class="storage storage_type storage_type_c">int</span> err =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">connect</span>(</span>sockfd, (<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">sockaddr</span> *</span>) &amp;server_addr,<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span>(</span>server_addr));
<span class='linenum'>  209</span>     <span class="keyword keyword_control keyword_control_c">if</span>(err != <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  210</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  211</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">perror</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>Error<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>);
<span class='linenum'>  212</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">3</span>);        
<span class='linenum'>  213</span>     }</span>
<span class='linenum'>  214</span> 
<span class='linenum'>  215</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Sending the operation TO the server
</span><span class='linenum'>  216</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">    </span><span class="support support_function support_function_any-method support_function_any-method_c">send</span> (</span>sockfd, (<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span>*</span>) &amp;messg,<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span>(</span>db_msg), <span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'>  217</span> 
<span class='linenum'>  218</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Waiting for the response FROM the server
</span><span class='linenum'>  219</span>     <span class="storage storage_type storage_type_c">int</span> len =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">recv</span>(</span>sockfd,(<span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span>*</span>) &amp;messg,<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">sizeof</span>(</span>db_msg), <span class="constant constant_numeric constant_numeric_c">0</span>);
<span class='linenum'>  220</span>     
<span class='linenum'>  221</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Closing socket
</span><span class='linenum'>  222</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">    </span><span class="support support_function support_function_any-method support_function_any-method_c">close</span>(</span>sockfd);
<span class='linenum'>  223</span>     
<span class='linenum'>  224</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Returning the response received from the server
</span><span class='linenum'>  225</span>     <span class="keyword keyword_control keyword_control_c">return</span> messg;
<span class='linenum'>  226</span> 
<span class='linenum'>  227</span> }</span></span></span>
<span class='linenum'>  228</span> 
<span class='linenum'>  229</span> 
<span class='linenum'>  230</span> 
<span class='linenum'>  231</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> db_query(int key, int srv, list&lt;replica&gt; replicalist)
</span><span class='linenum'>  232</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  233</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function performs the QUERY operation. It takes as input the key to query,
</span><span class='linenum'>  234</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> the server on which to perform the operation, and the list of available servers.
</span><span class='linenum'>  235</span> 
<span class='linenum'>  236</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">db_query</span><span class="meta meta_parens meta_parens_c">(<span class="storage storage_type storage_type_c">int</span> key, <span class="storage storage_type storage_type_c">int</span> srv, list&lt;replica&gt; replicalist)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  237</span>     
<span class='linenum'>  238</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">replica</span> server</span>;
<span class='linenum'>  239</span>     <span class="storage storage_type storage_type_c">bool</span> find = <span class="constant constant_numeric constant_numeric_c">0</span>;
<span class='linenum'>  240</span>     
<span class='linenum'>  241</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Searching if the server to contact is inside the server list
</span><span class='linenum'>  242</span>     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;replica&gt;::iterator it = replicalist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=replicalist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  243</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> == srv)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  244</span>             server = (*it);
<span class='linenum'>  245</span>             find = <span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  246</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  247</span>         }</span>
<span class='linenum'>  248</span>     }</span>
<span class='linenum'>  249</span>     
<span class='linenum'>  250</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  251</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>find == <span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  252</span>         cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>The server requested is not available<span class="constant constant_character constant_character_escape constant_character_escape_c">\n</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span>;
<span class='linenum'>  253</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">4</span>);
<span class='linenum'>  254</span>     }</span>
<span class='linenum'>  255</span>     
<span class='linenum'>  256</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Printing on the screen informations about the operation to perform
</span><span class='linenum'>  257</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>---- You want to QUERY the key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; key &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> from server <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; srv &lt;&lt; endl;
<span class='linenum'>  258</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>---- The server to contact is <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> at IP <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ip</span> &lt;&lt; endl;
<span class='linenum'>  259</span> 
<span class='linenum'>  260</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Sending the operation to perform_operation
</span><span class='linenum'>  261</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg </span>=<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">perform_operation</span>(</span>server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ip</span>, server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.port</span>, <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>Q<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>, key, <span class="constant constant_numeric constant_numeric_c">0</span>, server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span>);
<span class='linenum'>  262</span>     
<span class='linenum'>  263</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The result of the operation, received from the server
</span><span class='linenum'>  264</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>) == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>K<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> )<span class="meta meta_block meta_block_c">{
<span class='linenum'>  265</span>         cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>OK - QUERY of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> committed on server <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  266</span>         cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>     RESULT: key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> = <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.value</span> &lt;&lt; endl;
<span class='linenum'>  267</span>     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  268</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>) == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>A<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> )<span class="meta meta_block meta_block_c">{
<span class='linenum'>  269</span>             cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>OK - QUERY of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> committed on server <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  270</span>             cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>     RESULT: key not present<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  271</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{    
<span class='linenum'>  272</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>) == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>N<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> )<span class="meta meta_block meta_block_c">{
<span class='linenum'>  273</span>                 cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ABORT - QUERY of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> has been aborted by the distributed DB!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  274</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  275</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  276</span>                 cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! Cannot understand the response from the DB server!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  277</span>             }</span>
<span class='linenum'>  278</span>         }</span>
<span class='linenum'>  279</span>     }</span>
<span class='linenum'>  280</span> 
<span class='linenum'>  281</span> }</span></span>
<span class='linenum'>  282</span> 
<span class='linenum'>  283</span> 
<span class='linenum'>  284</span> 
<span class='linenum'>  285</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> db_delete(int key, list&lt;replica&gt; replicalist)
</span><span class='linenum'>  286</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  287</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function performs the DELETE operation. It takes as input the key to delete,
</span><span class='linenum'>  288</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> and the list of available servers.
</span><span class='linenum'>  289</span> 
<span class='linenum'>  290</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">db_delete</span><span class="meta meta_parens meta_parens_c">(<span class="storage storage_type storage_type_c">int</span> key, list&lt;replica&gt; replicalist)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  291</span> 
<span class='linenum'>  292</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">replica</span> server</span>;
<span class='linenum'>  293</span>     server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> = -<span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  294</span>     
<span class='linenum'>  295</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Searching for the nearest server to contact
</span><span class='linenum'>  296</span>     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;replica&gt;::iterator it = replicalist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=replicalist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  297</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt;= key)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  298</span>             server = (*it);
<span class='linenum'>  299</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  300</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  301</span>         }</span>
<span class='linenum'>  302</span>     }</span>
<span class='linenum'>  303</span>     
<span class='linenum'>  304</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Handling the situation for which there are no servers with
</span><span class='linenum'>  305</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Server.ID &lt;= key &lt; Next Server.ID
</span><span class='linenum'>  306</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> == -<span class="constant constant_numeric constant_numeric_c">1</span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  307</span>         cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! No server is available to serve operations with this key!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  308</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">5</span>);
<span class='linenum'>  309</span>     }</span>
<span class='linenum'>  310</span>     
<span class='linenum'>  311</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Printing on the screen informations about the operation to perform
</span><span class='linenum'>  312</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>---- You want to DELETE key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; key &lt;&lt; endl;
<span class='linenum'>  313</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>---- The server to contact is <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> at IP <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ip</span> &lt;&lt; endl;
<span class='linenum'>  314</span> 
<span class='linenum'>  315</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Sending the operation to perform_operation
</span><span class='linenum'>  316</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg </span>=<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">perform_operation</span>(</span>server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ip</span>, server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.port</span>, <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>D<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>, key, <span class="constant constant_numeric constant_numeric_c">0</span>, server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span>);
<span class='linenum'>  317</span>     
<span class='linenum'>  318</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The result of the operation, received from the server
</span><span class='linenum'>  319</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>) == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>K<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> )<span class="meta meta_block meta_block_c">{
<span class='linenum'>  320</span>         cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>OK - DELETE of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> committed on server <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  321</span>     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  322</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>) == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>N<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> )<span class="meta meta_block meta_block_c">{
<span class='linenum'>  323</span>             cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ABORT - DELETE of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> has been aborted by the distributed DB!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  324</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  325</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>) == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>W<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> )<span class="meta meta_block meta_block_c">{
<span class='linenum'>  326</span>                 cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! You contacted the wrong DB server!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  327</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  328</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  329</span>                 cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! Cannot understand the response from the DB server!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  330</span>             }</span>
<span class='linenum'>  331</span>         }</span>
<span class='linenum'>  332</span>     }</span>
<span class='linenum'>  333</span> 
<span class='linenum'>  334</span> }</span></span>
<span class='linenum'>  335</span> 
<span class='linenum'>  336</span> 
<span class='linenum'>  337</span> 
<span class='linenum'>  338</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> db_insert(int key, int value, list&lt;replica&gt; replicalist)
</span><span class='linenum'>  339</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  340</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> This function performs the INSERT operation. It takes as input the key to insert,
</span><span class='linenum'>  341</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> the value, and the list of available servers.
</span><span class='linenum'>  342</span> 
<span class='linenum'>  343</span> <span class="storage storage_type storage_type_c">void</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">db_insert</span><span class="meta meta_parens meta_parens_c">(<span class="storage storage_type storage_type_c">int</span> key, <span class="storage storage_type storage_type_c">int</span> value, list&lt;replica&gt; replicalist)</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  344</span>     
<span class='linenum'>  345</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">replica</span> server</span>;
<span class='linenum'>  346</span>     server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> = -<span class="constant constant_numeric constant_numeric_c">1</span>;
<span class='linenum'>  347</span>     
<span class='linenum'>  348</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Searching for the nearest server to contact
</span><span class='linenum'>  349</span>     <span class="keyword keyword_control keyword_control_c">for</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>list&lt;replica&gt;::iterator it = replicalist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">begin</span>(</span>); it!=replicalist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">end</span>(</span>); it++)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  350</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(*it)<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt;= key)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  351</span>             server = (*it);
<span class='linenum'>  352</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  353</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  354</span>         }</span>
<span class='linenum'>  355</span>     }</span>
<span class='linenum'>  356</span>     
<span class='linenum'>  357</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Handling the situation for which there are no servers with
</span><span class='linenum'>  358</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Server.ID &lt;= key &lt; Next Server.ID
</span><span class='linenum'>  359</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> == -<span class="constant constant_numeric constant_numeric_c">1</span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  360</span>         cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! No server is available to serve operations with this key!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  361</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">5</span>);
<span class='linenum'>  362</span>     }</span>
<span class='linenum'>  363</span>     
<span class='linenum'>  364</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Printing on the screen informations about the operation to perform
</span><span class='linenum'>  365</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>---- You want to INSERT the value <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; value &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> in key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; key &lt;&lt; endl;
<span class='linenum'>  366</span>     cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>---- The server to contact is <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> at IP <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ip</span> &lt;&lt; endl;
<span class='linenum'>  367</span> 
<span class='linenum'>  368</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Sending the operation to perform_operation
</span><span class='linenum'>  369</span>     <span class="meta meta_class-struct-block meta_class-struct-block_c++"><span class="storage storage_type storage_type_c++">struct</span> <span class="entity entity_name entity_name_type entity_name_type_c++">db_msg</span> messg </span>=<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">perform_operation</span>(</span>server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.ip</span>, server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.port</span>, <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>I<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>, key, value, server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span>);
<span class='linenum'>  370</span>     
<span class='linenum'>  371</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The result of the operation, received from the server
</span><span class='linenum'>  372</span>     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>) == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>K<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> )<span class="meta meta_block meta_block_c">{
<span class='linenum'>  373</span>         cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>OK - INSERT of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> committed on server <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; server<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.id</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  374</span>     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  375</span>         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>) == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>N<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> )<span class="meta meta_block meta_block_c">{
<span class='linenum'>  376</span>             cout &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ABORT - INSERT of key <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cpl.key</span> &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span> has been aborted by the distributed DB!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  377</span>         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  378</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>(messg<span class="variable variable_other variable_other_dot-access variable_other_dot-access_c">.cmd</span>) == <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>W<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span> )<span class="meta meta_block meta_block_c">{
<span class='linenum'>  379</span>                 cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! You contacted the wrong DB server!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  380</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  381</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  382</span>                 cerr &lt;&lt; <span class="string string_quoted string_quoted_double string_quoted_double_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">"</span>ERROR! Cannot understand the response from the DB server!<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">"</span></span> &lt;&lt; endl;
<span class='linenum'>  383</span>             }</span>
<span class='linenum'>  384</span>         }</span>
<span class='linenum'>  385</span>     }</span>
<span class='linenum'>  386</span> 
<span class='linenum'>  387</span> }</span></span>
<span class='linenum'>  388</span> 
<span class='linenum'>  389</span> 
<span class='linenum'>  390</span> 
<span class='linenum'>  391</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> create_replicalist()
</span><span class='linenum'>  392</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  393</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the list of servers, to fill with the data about the available
</span><span class='linenum'>  394</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> servers coming from the file.
</span><span class='linenum'>  395</span> 
<span class='linenum'>  396</span> list&lt;replica&gt;<span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">create_replicalist</span><span class="meta meta_parens meta_parens_c">()</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  397</span>     
<span class='linenum'>  398</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the list
</span><span class='linenum'>  399</span>     list&lt;replica&gt; replicalist;
<span class='linenum'>  400</span>     
<span class='linenum'>  401</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Asking read_file to read the server file and put these informations
</span><span class='linenum'>  402</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> in the list
</span><span class='linenum'>  403</span>     replicalist =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">read_file</span>(</span>replicalist);
<span class='linenum'>  404</span>     
<span class='linenum'>  405</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Sorting the list by the ID of the server
</span><span class='linenum'>  406</span>     replicalist.<span class="meta meta_function-call meta_function-call_c"><span class="support support_function support_function_any-method support_function_any-method_c">sort</span>(</span>compare_repid);
<span class='linenum'>  407</span>     
<span class='linenum'>  408</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Returning the list of servers filled with the informations taken
</span><span class='linenum'>  409</span>     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> from the file
</span><span class='linenum'>  410</span>     <span class="keyword keyword_control keyword_control_c">return</span> replicalist;
<span class='linenum'>  411</span> 
<span class='linenum'>  412</span> }</span></span>
<span class='linenum'>  413</span> 
<span class='linenum'>  414</span> 
<span class='linenum'>  415</span> 
<span class='linenum'>  416</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> main(int ARGC, char* ARGV[])
</span><span class='linenum'>  417</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>
</span><span class='linenum'>  418</span> <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> The main body
</span><span class='linenum'>  419</span> 
<span class='linenum'>  420</span> <span class="storage storage_type storage_type_c">int</span><span class="meta meta_function meta_function_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function punctuation_whitespace_function_leading punctuation_whitespace_function_leading_c"> </span><span class="entity entity_name entity_name_function entity_name_function_c">main</span><span class="meta meta_parens meta_parens_c">(<span class="storage storage_type storage_type_c">int</span> ARGC, <span class="storage storage_type storage_type_c">char</span>* ARGV[])</span><span class="meta meta_block meta_block_c">{
<span class='linenum'>  421</span>     
<span class='linenum'>  422</span>     <span class="storage storage_type storage_type_c">int</span> key = <span class="constant constant_numeric constant_numeric_c">0</span>;
<span class='linenum'>  423</span>     <span class="storage storage_type storage_type_c">int</span> value = <span class="constant constant_numeric constant_numeric_c">0</span>;
<span class='linenum'>  424</span>     list&lt;replica&gt; replicalist;
<span class='linenum'>  425</span>     
<span class='linenum'>  426</span>     <span class="keyword keyword_control keyword_control_c">switch</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>ARGC)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  427</span>         
<span class='linenum'>  428</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Two command line parameters, possible operation: DELETE
</span><span class='linenum'>  429</span>         <span class="keyword keyword_control keyword_control_c">case</span> <span class="constant constant_numeric constant_numeric_c">3</span>:
<span class='linenum'>  430</span>             
<span class='linenum'>  431</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">2</span>])!=<span class="constant constant_numeric constant_numeric_c">0</span>)<span class="meta meta_block meta_block_c">{
<span class='linenum'>  432</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Trying to convert to integer the key parameter
</span><span class='linenum'>  433</span>                 key =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">2</span>]);
<span class='linenum'>  434</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  435</span>                 <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>*ARGV[<span class="constant constant_numeric constant_numeric_c">2</span>]==<span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>0<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  436</span>                     key =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">2</span>]);
<span class='linenum'>  437</span>                 }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  438</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  439</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">print_error</span>(</span>);
<span class='linenum'>  440</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                    </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">1</span>);
<span class='linenum'>  441</span>                 }</span>
<span class='linenum'>  442</span>             }</span>
<span class='linenum'>  443</span>         
<span class='linenum'>  444</span>             <span class="keyword keyword_control keyword_control_c">switch</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>*ARGV[<span class="constant constant_numeric constant_numeric_c">1</span>]) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  445</span>                 
<span class='linenum'>  446</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> DELETE operation
</span><span class='linenum'>  447</span>                 <span class="keyword keyword_control keyword_control_c">case</span> <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>D<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>:
<span class='linenum'>  448</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the list of servers and filling it
</span><span class='linenum'>  449</span>                     replicalist =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">create_replicalist</span>(</span>);
<span class='linenum'>  450</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Performing the DELETE operation
</span><span class='linenum'>  451</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">db_delete</span>(</span>key, replicalist);
<span class='linenum'>  452</span>                     <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  453</span>                     
<span class='linenum'>  454</span>                 <span class="keyword keyword_control keyword_control_c">default</span>:
<span class='linenum'>  455</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  456</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">print_error</span>(</span>);
<span class='linenum'>  457</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                    </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">1</span>);
<span class='linenum'>  458</span>             }</span>
<span class='linenum'>  459</span>             
<span class='linenum'>  460</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  461</span>             
<span class='linenum'>  462</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Three command line parameters, possible operation: QUERY or INSERT
</span><span class='linenum'>  463</span>         <span class="keyword keyword_control keyword_control_c">case</span> <span class="constant constant_numeric constant_numeric_c">4</span>:
<span class='linenum'>  464</span>         
<span class='linenum'>  465</span>             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span>if (atoi(ARGV[2])!=0 &amp;&amp; atoi(ARGV[3])!=0){
</span><span class='linenum'>  466</span>             <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">2</span>])!=<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  467</span>                 <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">3</span>])!=<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{ 
<span class='linenum'>  468</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Trying to convert to integer the key and value parameter
</span><span class='linenum'>  469</span>                     key =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">2</span>]);
<span class='linenum'>  470</span>                     value =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">3</span>]);
<span class='linenum'>  471</span>                 }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  472</span>                     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>*ARGV[<span class="constant constant_numeric constant_numeric_c">3</span>]==<span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>0<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  473</span>                         key =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">2</span>]);
<span class='linenum'>  474</span>                         value =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">3</span>]);
<span class='linenum'>  475</span>                     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  476</span>                         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  477</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                        </span><span class="support support_function support_function_any-method support_function_any-method_c">print_error</span>(</span>);
<span class='linenum'>  478</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                        </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">1</span>);
<span class='linenum'>  479</span>                     }</span>
<span class='linenum'>  480</span>                 }</span>
<span class='linenum'>  481</span>             }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  482</span>                 <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>*ARGV[<span class="constant constant_numeric constant_numeric_c">2</span>]==<span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>0<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  483</span>                     <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">3</span>])!=<span class="constant constant_numeric constant_numeric_c">0</span>) <span class="meta meta_block meta_block_c">{ 
<span class='linenum'>  484</span>                         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Trying to convert to integer the key and value parameter
</span><span class='linenum'>  485</span>                         key =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">2</span>]);
<span class='linenum'>  486</span>                         value =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">3</span>]);
<span class='linenum'>  487</span>                     }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  488</span>                         <span class="keyword keyword_control keyword_control_c">if</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>*ARGV[<span class="constant constant_numeric constant_numeric_c">3</span>]==<span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>0<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  489</span>                             key =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">2</span>]);
<span class='linenum'>  490</span>                             value =<span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c"> </span><span class="support support_function support_function_C99 support_function_C99_c">atoi</span>(ARGV[<span class="constant constant_numeric constant_numeric_c">3</span>]);
<span class='linenum'>  491</span>                         }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  492</span>                             <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  493</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                            </span><span class="support support_function support_function_any-method support_function_any-method_c">print_error</span>(</span>);
<span class='linenum'>  494</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                            </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">1</span>);
<span class='linenum'>  495</span>                         }</span>
<span class='linenum'>  496</span>                     }</span>
<span class='linenum'>  497</span>                 }</span> <span class="keyword keyword_control keyword_control_c">else</span> <span class="meta meta_block meta_block_c">{
<span class='linenum'>  498</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  499</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">print_error</span>(</span>);
<span class='linenum'>  500</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                    </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">1</span>);
<span class='linenum'>  501</span>                 }</span>
<span class='linenum'>  502</span>             }</span>
<span class='linenum'>  503</span>         
<span class='linenum'>  504</span>             <span class="keyword keyword_control keyword_control_c">switch</span><span class="meta meta_initialization meta_initialization_c"> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_c">(</span></span>*ARGV[<span class="constant constant_numeric constant_numeric_c">1</span>]) <span class="meta meta_block meta_block_c">{
<span class='linenum'>  505</span>                 
<span class='linenum'>  506</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> QUERY operation
</span><span class='linenum'>  507</span>                 <span class="keyword keyword_control keyword_control_c">case</span> <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>Q<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>:
<span class='linenum'>  508</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the list of servers and filling it
</span><span class='linenum'>  509</span>                     replicalist =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">create_replicalist</span>(</span>);
<span class='linenum'>  510</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Performing the QUERY operation
</span><span class='linenum'>  511</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">db_query</span>(</span>key, value, replicalist);
<span class='linenum'>  512</span>                     <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  513</span>                     
<span class='linenum'>  514</span>                 <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> INSERT operation
</span><span class='linenum'>  515</span>                 <span class="keyword keyword_control keyword_control_c">case</span> <span class="string string_quoted string_quoted_single string_quoted_single_c"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_c">'</span>I<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_c">'</span></span>:
<span class='linenum'>  516</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Creating the list of servers and filling it
</span><span class='linenum'>  517</span>                     replicalist =<span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c"> </span><span class="support support_function support_function_any-method support_function_any-method_c">create_replicalist</span>(</span>);
<span class='linenum'>  518</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Performing the INSERT operation
</span><span class='linenum'>  519</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">db_insert</span>(</span>key, value, replicalist);
<span class='linenum'>  520</span>                     <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  521</span>                     
<span class='linenum'>  522</span>                 <span class="keyword keyword_control keyword_control_c">default</span>:
<span class='linenum'>  523</span>                     <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  524</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">                    </span><span class="support support_function support_function_any-method support_function_any-method_c">print_error</span>(</span>);
<span class='linenum'>  525</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">                    </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">1</span>);
<span class='linenum'>  526</span>             }</span>
<span class='linenum'>  527</span>             <span class="keyword keyword_control keyword_control_c">break</span>;
<span class='linenum'>  528</span>             
<span class='linenum'>  529</span>         <span class="comment comment_line comment_line_double-slash comment_line_double-slash_c++"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_c">//</span> Error handling
</span><span class='linenum'>  530</span>         <span class="keyword keyword_control keyword_control_c">default</span>:
<span class='linenum'>  531</span> <span class="meta meta_function-call meta_function-call_c"><span class="punctuation punctuation_whitespace punctuation_whitespace_function-call punctuation_whitespace_function-call_leading punctuation_whitespace_function-call_leading_c">            </span><span class="support support_function support_function_any-method support_function_any-method_c">print_error</span>(</span>);
<span class='linenum'>  532</span> <span class="punctuation punctuation_whitespace punctuation_whitespace_support punctuation_whitespace_support_function punctuation_whitespace_support_function_leading punctuation_whitespace_support_function_leading_c">            </span><span class="support support_function support_function_C99 support_function_C99_c">exit</span>(<span class="constant constant_numeric constant_numeric_c">1</span>);
<span class='linenum'>  533</span>                     
<span class='linenum'>  534</span>     }</span>
<span class='linenum'>  535</span>     
<span class='linenum'>  536</span>     cout &lt;&lt; endl;
<span class='linenum'>  537</span> }</span></span></span></pre>
</body>
</html>